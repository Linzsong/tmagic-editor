const __vite__fileDeps=["assets/comp-entry-BLA7j4kV.js","assets/comp-entry-C9liEODB.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var si=Object.defineProperty;var pr=e=>{throw TypeError(e)};var ii=(e,t,r)=>t in e?si(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var m=(e,t,r)=>ii(e,typeof t!="symbol"?t+"":t,r),gr=(e,t,r)=>t.has(e)||pr("Cannot "+r);var F=(e,t,r)=>(gr(e,t,"read from private field"),r?r.call(e):t.get(e)),z=(e,t,r)=>t.has(e)?pr("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),q=(e,t,r,n)=>(gr(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);function Ip(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const oi="modulepreload",ai=function(e){return"/tmagic-editor/playground/runtime/vue3/playground/"+e},mr={},Mt=function(t,r,n){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),i=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.all(r.map(a=>{if(a=ai(a),a in mr)return;mr[a]=!0;const c=a.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector('link[href="'.concat(a,'"]').concat(u)))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":oi,c||(f.as="script",f.crossOrigin=""),f.href=a,i&&f.setAttribute("nonce",i),document.head.appendChild(f),c)return new Promise((l,h)=>{f.addEventListener("load",l),f.addEventListener("error",()=>h(new Error("Unable to preload CSS for ".concat(a))))})}))}return s.then(()=>t()).catch(o=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o})};var Cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ci(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Yt={exports:{}},Ae=typeof Reflect=="object"?Reflect:null,yr=Ae&&typeof Ae.apply=="function"?Ae.apply:function(t,r,n){return Function.prototype.apply.call(t,r,n)},ut;Ae&&typeof Ae.ownKeys=="function"?ut=Ae.ownKeys:Object.getOwnPropertySymbols?ut=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ut=function(t){return Object.getOwnPropertyNames(t)};function ui(e){console&&console.warn&&console.warn(e)}var Dn=Number.isNaN||function(t){return t!==t};function A(){A.init.call(this)}Yt.exports=A;Yt.exports.once=di;A.EventEmitter=A;A.prototype._events=void 0;A.prototype._eventsCount=0;A.prototype._maxListeners=void 0;var br=10;function wt(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(A,"defaultMaxListeners",{enumerable:!0,get:function(){return br},set:function(e){if(typeof e!="number"||e<0||Dn(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");br=e}});A.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};A.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Dn(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Mn(e){return e._maxListeners===void 0?A.defaultMaxListeners:e._maxListeners}A.prototype.getMaxListeners=function(){return Mn(this)};A.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var s=t==="error",o=this._events;if(o!==void 0)s=s&&o.error===void 0;else if(!s)return!1;if(s){var i;if(r.length>0&&(i=r[0]),i instanceof Error)throw i;var a=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw a.context=i,a}var c=o[t];if(c===void 0)return!1;if(typeof c=="function")yr(c,this,r);else for(var u=c.length,f=Rn(c,u),n=0;n<u;++n)yr(f[n],this,r);return!0};function xn(e,t,r,n){var s,o,i;if(wt(r),o=e._events,o===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),i=o[t]),i===void 0)i=o[t]=r,++e._eventsCount;else if(typeof i=="function"?i=o[t]=n?[r,i]:[i,r]:n?i.unshift(r):i.push(r),s=Mn(e),s>0&&i.length>s&&!i.warned){i.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=i.length,ui(a)}return e}A.prototype.addListener=function(t,r){return xn(this,t,r,!1)};A.prototype.on=A.prototype.addListener;A.prototype.prependListener=function(t,r){return xn(this,t,r,!0)};function fi(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ln(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},s=fi.bind(n);return s.listener=r,n.wrapFn=s,s}A.prototype.once=function(t,r){return wt(r),this.on(t,Ln(this,t,r)),this};A.prototype.prependOnceListener=function(t,r){return wt(r),this.prependListener(t,Ln(this,t,r)),this};A.prototype.removeListener=function(t,r){var n,s,o,i,a;if(wt(r),s=this._events,s===void 0)return this;if(n=s[t],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,n.listener||r));else if(typeof n!="function"){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===r||n[i].listener===r){a=n[i].listener,o=i;break}if(o<0)return this;o===0?n.shift():li(n,o),n.length===1&&(s[t]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",t,a||r)}return this};A.prototype.off=A.prototype.removeListener;A.prototype.removeAllListeners=function(t){var r,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var o=Object.keys(n),i;for(s=0;s<o.length;++s)i=o[s],i!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(s=r.length-1;s>=0;s--)this.removeListener(t,r[s]);return this};function Pn(e,t,r){var n=e._events;if(n===void 0)return[];var s=n[t];return s===void 0?[]:typeof s=="function"?r?[s.listener||s]:[s]:r?hi(s):Rn(s,s.length)}A.prototype.listeners=function(t){return Pn(this,t,!0)};A.prototype.rawListeners=function(t){return Pn(this,t,!1)};A.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):Nn.call(e,t)};A.prototype.listenerCount=Nn;function Nn(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}A.prototype.eventNames=function(){return this._eventsCount>0?ut(this._events):[]};function Rn(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function li(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function hi(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function di(e,t){return new Promise(function(r,n){function s(i){e.removeListener(t,o),n(i)}function o(){typeof e.removeListener=="function"&&e.removeListener("error",s),r([].slice.call(arguments))}Fn(e,t,o,{once:!0}),t!=="error"&&pi(e,s,{once:!0})})}function pi(e,t,r){typeof e.on=="function"&&Fn(e,"error",t,r)}function Fn(e,t,r,n){if(typeof e.on=="function")n.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function s(o){n.once&&e.removeEventListener(t,s),r(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var Tt=Yt.exports;const Un=ci(Tt);var kn=typeof global=="object"&&global&&global.Object===Object&&global,gi=typeof self=="object"&&self&&self.Object===Object&&self,J=kn||gi||Function("return this")(),ce=J.Symbol,Wn=Object.prototype,mi=Wn.hasOwnProperty,yi=Wn.toString,Be=ce?ce.toStringTag:void 0;function bi(e){var t=mi.call(e,Be),r=e[Be];try{e[Be]=void 0;var n=!0}catch(o){}var s=yi.call(e);return n&&(t?e[Be]=r:delete e[Be]),s}var vi=Object.prototype,$i=vi.toString;function _i(e){return $i.call(e)}var wi="[object Null]",Ti="[object Undefined]",vr=ce?ce.toStringTag:void 0;function Le(e){return e==null?e===void 0?Ti:wi:vr&&vr in Object(e)?bi(e):_i(e)}function Pe(e){return e!=null&&typeof e=="object"}var Oi="[object Symbol]";function Kt(e){return typeof e=="symbol"||Pe(e)&&Le(e)==Oi}function Si(e,t){for(var r=-1,n=e==null?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var te=Array.isArray,ji=1/0,$r=ce?ce.prototype:void 0,_r=$r?$r.toString:void 0;function Bn(e){if(typeof e=="string")return e;if(te(e))return Si(e,Bn)+"";if(Kt(e))return _r?_r.call(e):"";var t=e+"";return t=="0"&&1/e==-ji?"-0":t}function ge(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ei="[object AsyncFunction]",Ai="[object Function]",Ii="[object GeneratorFunction]",Ci="[object Proxy]";function Hn(e){if(!ge(e))return!1;var t=Le(e);return t==Ai||t==Ii||t==Ei||t==Ci}var xt=J["__core-js_shared__"],wr=function(){var e=/[^.]+$/.exec(xt&&xt.keys&&xt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Di(e){return!!wr&&wr in e}var Mi=Function.prototype,xi=Mi.toString;function ve(e){if(e!=null){try{return xi.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var Li=/[\\^$.*+?()[\]{}|]/g,Pi=/^\[object .+?Constructor\]$/,Ni=Function.prototype,Ri=Object.prototype,Fi=Ni.toString,Ui=Ri.hasOwnProperty,ki=RegExp("^"+Fi.call(Ui).replace(Li,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Wi(e){if(!ge(e)||Di(e))return!1;var t=Hn(e)?ki:Pi;return t.test(ve(e))}function Bi(e,t){return e==null?void 0:e[t]}function $e(e,t){var r=Bi(e,t);return Wi(r)?r:void 0}var Ut=$e(J,"WeakMap"),Tr=Object.create,Hi=function(){function e(){}return function(t){if(!ge(t))return{};if(Tr)return Tr(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function zi(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var Or=function(){try{var e=$e(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();function Gi(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}var qi=9007199254740991,Qi=/^(?:0|[1-9]\d*)$/;function Vt(e,t){var r=typeof e;return t=t==null?qi:t,!!t&&(r=="number"||r!="symbol"&&Qi.test(e))&&e>-1&&e%1==0&&e<t}function zn(e,t,r){t=="__proto__"&&Or?Or(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function Gn(e,t){return e===t||e!==e&&t!==t}var Yi=Object.prototype,Ki=Yi.hasOwnProperty;function Jt(e,t,r){var n=e[t];(!(Ki.call(e,t)&&Gn(n,r))||r===void 0&&!(t in e))&&zn(e,t,r)}function Ot(e,t,r,n){var s=!r;r||(r={});for(var o=-1,i=t.length;++o<i;){var a=t[o],c=void 0;c===void 0&&(c=e[a]),s?zn(r,a,c):Jt(r,a,c)}return r}var Vi=9007199254740991;function Xt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Vi}function Zt(e){return e!=null&&Xt(e.length)&&!Hn(e)}var Ji=Object.prototype;function St(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Ji;return e===r}function Xi(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var Zi="[object Arguments]";function Sr(e){return Pe(e)&&Le(e)==Zi}var qn=Object.prototype,eo=qn.hasOwnProperty,to=qn.propertyIsEnumerable,er=Sr(function(){return arguments}())?Sr:function(e){return Pe(e)&&eo.call(e,"callee")&&!to.call(e,"callee")};function ro(){return!1}var Qn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,jr=Qn&&typeof module=="object"&&module&&!module.nodeType&&module,no=jr&&jr.exports===Qn,Er=no?J.Buffer:void 0,so=Er?Er.isBuffer:void 0,tr=so||ro,io="[object Arguments]",oo="[object Array]",ao="[object Boolean]",co="[object Date]",uo="[object Error]",fo="[object Function]",lo="[object Map]",ho="[object Number]",po="[object Object]",go="[object RegExp]",mo="[object Set]",yo="[object String]",bo="[object WeakMap]",vo="[object ArrayBuffer]",$o="[object DataView]",_o="[object Float32Array]",wo="[object Float64Array]",To="[object Int8Array]",Oo="[object Int16Array]",So="[object Int32Array]",jo="[object Uint8Array]",Eo="[object Uint8ClampedArray]",Ao="[object Uint16Array]",Io="[object Uint32Array]",M={};M[_o]=M[wo]=M[To]=M[Oo]=M[So]=M[jo]=M[Eo]=M[Ao]=M[Io]=!0;M[io]=M[oo]=M[vo]=M[ao]=M[$o]=M[co]=M[uo]=M[fo]=M[lo]=M[ho]=M[po]=M[go]=M[mo]=M[yo]=M[bo]=!1;function Co(e){return Pe(e)&&Xt(e.length)&&!!M[Le(e)]}function rr(e){return function(t){return e(t)}}var Yn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ze=Yn&&typeof module=="object"&&module&&!module.nodeType&&module,Do=ze&&ze.exports===Yn,Lt=Do&&kn.process,De=function(){try{var e=ze&&ze.require&&ze.require("util").types;return e||Lt&&Lt.binding&&Lt.binding("util")}catch(t){}}(),Ar=De&&De.isTypedArray,Kn=Ar?rr(Ar):Co,Mo=Object.prototype,xo=Mo.hasOwnProperty;function Vn(e,t){var r=te(e),n=!r&&er(e),s=!r&&!n&&tr(e),o=!r&&!n&&!s&&Kn(e),i=r||n||s||o,a=i?Xi(e.length,String):[],c=a.length;for(var u in e)(t||xo.call(e,u))&&!(i&&(u=="length"||s&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Vt(u,c)))&&a.push(u);return a}function Jn(e,t){return function(r){return e(t(r))}}var Lo=Jn(Object.keys,Object),Po=Object.prototype,No=Po.hasOwnProperty;function Xn(e){if(!St(e))return Lo(e);var t=[];for(var r in Object(e))No.call(e,r)&&r!="constructor"&&t.push(r);return t}function nr(e){return Zt(e)?Vn(e):Xn(e)}function Ro(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var Fo=Object.prototype,Uo=Fo.hasOwnProperty;function ko(e){if(!ge(e))return Ro(e);var t=St(e),r=[];for(var n in e)n=="constructor"&&(t||!Uo.call(e,n))||r.push(n);return r}function sr(e){return Zt(e)?Vn(e,!0):ko(e)}var Wo=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Bo=/^\w*$/;function Ho(e,t){if(te(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Kt(e)?!0:Bo.test(e)||!Wo.test(e)||t!=null&&e in Object(t)}var Qe=$e(Object,"create");function zo(){this.__data__=Qe?Qe(null):{},this.size=0}function Go(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var qo="__lodash_hash_undefined__",Qo=Object.prototype,Yo=Qo.hasOwnProperty;function Ko(e){var t=this.__data__;if(Qe){var r=t[e];return r===qo?void 0:r}return Yo.call(t,e)?t[e]:void 0}var Vo=Object.prototype,Jo=Vo.hasOwnProperty;function Xo(e){var t=this.__data__;return Qe?t[e]!==void 0:Jo.call(t,e)}var Zo="__lodash_hash_undefined__";function ea(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Qe&&t===void 0?Zo:t,this}function me(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}me.prototype.clear=zo;me.prototype.delete=Go;me.prototype.get=Ko;me.prototype.has=Xo;me.prototype.set=ea;function ta(){this.__data__=[],this.size=0}function jt(e,t){for(var r=e.length;r--;)if(Gn(e[r][0],t))return r;return-1}var ra=Array.prototype,na=ra.splice;function sa(e){var t=this.__data__,r=jt(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():na.call(t,r,1),--this.size,!0}function ia(e){var t=this.__data__,r=jt(t,e);return r<0?void 0:t[r][1]}function oa(e){return jt(this.__data__,e)>-1}function aa(e,t){var r=this.__data__,n=jt(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function re(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}re.prototype.clear=ta;re.prototype.delete=sa;re.prototype.get=ia;re.prototype.has=oa;re.prototype.set=aa;var Ye=$e(J,"Map");function ca(){this.size=0,this.__data__={hash:new me,map:new(Ye||re),string:new me}}function ua(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Et(e,t){var r=e.__data__;return ua(t)?r[typeof t=="string"?"string":"hash"]:r.map}function fa(e){var t=Et(this,e).delete(e);return this.size-=t?1:0,t}function la(e){return Et(this,e).get(e)}function ha(e){return Et(this,e).has(e)}function da(e,t){var r=Et(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function ue(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ue.prototype.clear=ca;ue.prototype.delete=fa;ue.prototype.get=la;ue.prototype.has=ha;ue.prototype.set=da;var pa="Expected a function";function ir(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(pa);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],o=r.cache;if(o.has(s))return o.get(s);var i=e.apply(this,n);return r.cache=o.set(s,i)||o,i};return r.cache=new(ir.Cache||ue),r}ir.Cache=ue;var ga=500;function ma(e){var t=ir(e,function(n){return r.size===ga&&r.clear(),n}),r=t.cache;return t}var ya=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ba=/\\(\\)?/g,va=ma(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(ya,function(r,n,s,o){t.push(s?o.replace(ba,"$1"):n||r)}),t});function $a(e){return e==null?"":Bn(e)}function Zn(e,t){return te(e)?e:Ho(e,t)?[e]:va($a(e))}var _a=1/0;function es(e){if(typeof e=="string"||Kt(e))return e;var t=e+"";return t=="0"&&1/e==-_a?"-0":t}function ts(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}var rs=Jn(Object.getPrototypeOf,Object);function wa(){this.__data__=new re,this.size=0}function Ta(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function Oa(e){return this.__data__.get(e)}function Sa(e){return this.__data__.has(e)}var ja=200;function Ea(e,t){var r=this.__data__;if(r instanceof re){var n=r.__data__;if(!Ye||n.length<ja-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new ue(n)}return r.set(e,t),this.size=r.size,this}function Ne(e){var t=this.__data__=new re(e);this.size=t.size}Ne.prototype.clear=wa;Ne.prototype.delete=Ta;Ne.prototype.get=Oa;Ne.prototype.has=Sa;Ne.prototype.set=Ea;function Aa(e,t){return e&&Ot(t,nr(t),e)}function Ia(e,t){return e&&Ot(t,sr(t),e)}var ns=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ir=ns&&typeof module=="object"&&module&&!module.nodeType&&module,Ca=Ir&&Ir.exports===ns,Cr=Ca?J.Buffer:void 0,Dr=Cr?Cr.allocUnsafe:void 0;function Da(e,t){if(t)return e.slice();var r=e.length,n=Dr?Dr(r):new e.constructor(r);return e.copy(n),n}function Ma(e,t){for(var r=-1,n=e==null?0:e.length,s=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[s++]=i)}return o}function ss(){return[]}var xa=Object.prototype,La=xa.propertyIsEnumerable,Mr=Object.getOwnPropertySymbols,or=Mr?function(e){return e==null?[]:(e=Object(e),Ma(Mr(e),function(t){return La.call(e,t)}))}:ss;function Pa(e,t){return Ot(e,or(e),t)}var Na=Object.getOwnPropertySymbols,is=Na?function(e){for(var t=[];e;)ts(t,or(e)),e=rs(e);return t}:ss;function Ra(e,t){return Ot(e,is(e),t)}function os(e,t,r){var n=t(e);return te(e)?n:ts(n,r(e))}function Fa(e){return os(e,nr,or)}function Ua(e){return os(e,sr,is)}var kt=$e(J,"DataView"),Wt=$e(J,"Promise"),Bt=$e(J,"Set"),xr="[object Map]",ka="[object Object]",Lr="[object Promise]",Pr="[object Set]",Nr="[object WeakMap]",Rr="[object DataView]",Wa=ve(kt),Ba=ve(Ye),Ha=ve(Wt),za=ve(Bt),Ga=ve(Ut),K=Le;(kt&&K(new kt(new ArrayBuffer(1)))!=Rr||Ye&&K(new Ye)!=xr||Wt&&K(Wt.resolve())!=Lr||Bt&&K(new Bt)!=Pr||Ut&&K(new Ut)!=Nr)&&(K=function(e){var t=Le(e),r=t==ka?e.constructor:void 0,n=r?ve(r):"";if(n)switch(n){case Wa:return Rr;case Ba:return xr;case Ha:return Lr;case za:return Pr;case Ga:return Nr}return t});var qa=Object.prototype,Qa=qa.hasOwnProperty;function Ya(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&Qa.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var Fr=J.Uint8Array;function ar(e){var t=new e.constructor(e.byteLength);return new Fr(t).set(new Fr(e)),t}function Ka(e,t){var r=t?ar(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var Va=/\w*$/;function Ja(e){var t=new e.constructor(e.source,Va.exec(e));return t.lastIndex=e.lastIndex,t}var Ur=ce?ce.prototype:void 0,kr=Ur?Ur.valueOf:void 0;function Xa(e){return kr?Object(kr.call(e)):{}}function Za(e,t){var r=t?ar(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var ec="[object Boolean]",tc="[object Date]",rc="[object Map]",nc="[object Number]",sc="[object RegExp]",ic="[object Set]",oc="[object String]",ac="[object Symbol]",cc="[object ArrayBuffer]",uc="[object DataView]",fc="[object Float32Array]",lc="[object Float64Array]",hc="[object Int8Array]",dc="[object Int16Array]",pc="[object Int32Array]",gc="[object Uint8Array]",mc="[object Uint8ClampedArray]",yc="[object Uint16Array]",bc="[object Uint32Array]";function vc(e,t,r){var n=e.constructor;switch(t){case cc:return ar(e);case ec:case tc:return new n(+e);case uc:return Ka(e,r);case fc:case lc:case hc:case dc:case pc:case gc:case mc:case yc:case bc:return Za(e,r);case rc:return new n;case nc:case oc:return new n(e);case sc:return Ja(e);case ic:return new n;case ac:return Xa(e)}}function $c(e){return typeof e.constructor=="function"&&!St(e)?Hi(rs(e)):{}}var _c="[object Map]";function wc(e){return Pe(e)&&K(e)==_c}var Wr=De&&De.isMap,Tc=Wr?rr(Wr):wc,Oc="[object Set]";function Sc(e){return Pe(e)&&K(e)==Oc}var Br=De&&De.isSet,jc=Br?rr(Br):Sc,Ec=1,Ac=2,Ic=4,as="[object Arguments]",Cc="[object Array]",Dc="[object Boolean]",Mc="[object Date]",xc="[object Error]",cs="[object Function]",Lc="[object GeneratorFunction]",Pc="[object Map]",Nc="[object Number]",us="[object Object]",Rc="[object RegExp]",Fc="[object Set]",Uc="[object String]",kc="[object Symbol]",Wc="[object WeakMap]",Bc="[object ArrayBuffer]",Hc="[object DataView]",zc="[object Float32Array]",Gc="[object Float64Array]",qc="[object Int8Array]",Qc="[object Int16Array]",Yc="[object Int32Array]",Kc="[object Uint8Array]",Vc="[object Uint8ClampedArray]",Jc="[object Uint16Array]",Xc="[object Uint32Array]",C={};C[as]=C[Cc]=C[Bc]=C[Hc]=C[Dc]=C[Mc]=C[zc]=C[Gc]=C[qc]=C[Qc]=C[Yc]=C[Pc]=C[Nc]=C[us]=C[Rc]=C[Fc]=C[Uc]=C[kc]=C[Kc]=C[Vc]=C[Jc]=C[Xc]=!0;C[xc]=C[cs]=C[Wc]=!1;function ft(e,t,r,n,s,o){var i,a=t&Ec,c=t&Ac,u=t&Ic;if(i!==void 0)return i;if(!ge(e))return e;var f=te(e);if(f){if(i=Ya(e),!a)return zi(e,i)}else{var l=K(e),h=l==cs||l==Lc;if(tr(e))return Da(e,a);if(l==us||l==as||h&&!s){if(i=c||h?{}:$c(e),!a)return c?Ra(e,Ia(i,e)):Pa(e,Aa(i,e))}else{if(!C[l])return s?e:{};i=vc(e,l,a)}}o||(o=new Ne);var d=o.get(e);if(d)return d;o.set(e,i),jc(e)?e.forEach(function(_){i.add(ft(_,t,r,_,e,o))}):Tc(e)&&e.forEach(function(_,j){i.set(j,ft(_,t,r,j,e,o))});var b=u?c?Ua:Fa:c?sr:nr,g=f?void 0:b(e);return Gi(g||e,function(_,j){g&&(j=_,_=e[j]),Jt(i,j,ft(_,t,r,j,e,o))}),i}var Zc=1,eu=4;function tu(e){return ft(e,Zc|eu)}function ru(e,t,r){t=Zn(t,e);for(var n=-1,s=t.length,o=!1;++n<s;){var i=es(t[n]);if(!(o=e!=null&&r(e,i)))break;e=e[i]}return o||++n!=s?o:(s=e==null?0:e.length,!!s&&Xt(s)&&Vt(i,s)&&(te(e)||er(e)))}var nu=Object.prototype,su=nu.hasOwnProperty;function iu(e,t){return e!=null&&su.call(e,t)}function ou(e,t){return e!=null&&ru(e,t,iu)}var au="[object Map]",cu="[object Set]",uu=Object.prototype,fu=uu.hasOwnProperty;function lu(e){if(e==null)return!0;if(Zt(e)&&(te(e)||typeof e=="string"||typeof e.splice=="function"||tr(e)||Kn(e)||er(e)))return!e.length;var t=K(e);if(t==au||t==cu)return!e.size;if(St(e))return!Xn(e).length;for(var r in e)if(fu.call(e,r))return!1;return!0}function hu(e,t,r,n){if(!ge(e))return e;t=Zn(t,e);for(var s=-1,o=t.length,i=o-1,a=e;a!=null&&++s<o;){var c=es(t[s]),u=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(s!=i){var f=a[c];u=void 0,u===void 0&&(u=ge(f)?f:Vt(t[s+1])?[]:{})}Jt(a,c,u),a=a[c]}return e}function du(e,t,r){return e==null?e:hu(e,t,r)}var pu={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Cn,function(){var r=1e3,n=6e4,s=36e5,o="millisecond",i="second",a="minute",c="hour",u="day",f="week",l="month",h="quarter",d="year",b="date",g="Invalid Date",_=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,j=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,S={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(w){var v=["th","st","nd","rd"],p=w%100;return"["+w+(v[(p-20)%10]||v[p]||v[0])+"]"}},L=function(w,v,p){var $=String(w);return!$||$.length>=v?w:""+Array(v+1-$.length).join(p)+w},G={s:L,z:function(w){var v=-w.utcOffset(),p=Math.abs(v),$=Math.floor(p/60),y=p%60;return(v<=0?"+":"-")+L($,2,"0")+":"+L(y,2,"0")},m:function w(v,p){if(v.date()<p.date())return-w(p,v);var $=12*(p.year()-v.year())+(p.month()-v.month()),y=v.clone().add($,l),T=p-y<0,O=v.clone().add($+(T?-1:1),l);return+(-($+(p-y)/(T?y-O:O-y))||0)},a:function(w){return w<0?Math.ceil(w)||0:Math.floor(w)},p:function(w){return{M:l,y:d,w:f,d:u,D:b,h:c,m:a,s:i,ms:o,Q:h}[w]||String(w||"").toLowerCase().replace(/s$/,"")},u:function(w){return w===void 0}},k="en",B={};B[k]=S;var Oe="$isDayjsObject",Ue=function(w){return w instanceof nt||!(!w||!w[Oe])},ie=function w(v,p,$){var y;if(!v)return k;if(typeof v=="string"){var T=v.toLowerCase();B[T]&&(y=T),p&&(B[T]=p,y=T);var O=v.split("-");if(!y&&O.length>1)return w(O[0])}else{var I=v.name;B[I]=v,y=I}return!$&&y&&(k=y),y||!$&&k},N=function(w,v){if(Ue(w))return w.clone();var p=typeof v=="object"?v:{};return p.date=w,p.args=arguments,new nt(p)},E=G;E.l=ie,E.i=Ue,E.w=function(w,v){return N(w,{locale:v.$L,utc:v.$u,x:v.$x,$offset:v.$offset})};var nt=function(){function w(p){this.$L=ie(p.locale,null,!0),this.parse(p),this.$x=this.$x||p.x||{},this[Oe]=!0}var v=w.prototype;return v.parse=function(p){this.$d=function($){var y=$.date,T=$.utc;if(y===null)return new Date(NaN);if(E.u(y))return new Date;if(y instanceof Date)return new Date(y);if(typeof y=="string"&&!/Z$/i.test(y)){var O=y.match(_);if(O){var I=O[2]-1||0,P=(O[7]||"0").substring(0,3);return T?new Date(Date.UTC(O[1],I,O[3]||1,O[4]||0,O[5]||0,O[6]||0,P)):new Date(O[1],I,O[3]||1,O[4]||0,O[5]||0,O[6]||0,P)}}return new Date(y)}(p),this.init()},v.init=function(){var p=this.$d;this.$y=p.getFullYear(),this.$M=p.getMonth(),this.$D=p.getDate(),this.$W=p.getDay(),this.$H=p.getHours(),this.$m=p.getMinutes(),this.$s=p.getSeconds(),this.$ms=p.getMilliseconds()},v.$utils=function(){return E},v.isValid=function(){return this.$d.toString()!==g},v.isSame=function(p,$){var y=N(p);return this.startOf($)<=y&&y<=this.endOf($)},v.isAfter=function(p,$){return N(p)<this.startOf($)},v.isBefore=function(p,$){return this.endOf($)<N(p)},v.$g=function(p,$,y){return E.u(p)?this[$]:this.set(y,p)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(p,$){var y=this,T=!!E.u($)||$,O=E.p(p),I=function(he,W){var oe=E.w(y.$u?Date.UTC(y.$y,W,he):new Date(y.$y,W,he),y);return T?oe:oe.endOf(u)},P=function(he,W){return E.w(y.toDate()[he].apply(y.toDate("s"),(T?[0,0,0,0]:[23,59,59,999]).slice(W)),y)},R=this.$W,U=this.$M,H=this.$D,Se="set"+(this.$u?"UTC":"");switch(O){case d:return T?I(1,0):I(31,11);case l:return T?I(1,U):I(0,U+1);case f:var le=this.$locale().weekStart||0,ke=(R<le?R+7:R)-le;return I(T?H-ke:H+(6-ke),U);case u:case b:return P(Se+"Hours",0);case c:return P(Se+"Minutes",1);case a:return P(Se+"Seconds",2);case i:return P(Se+"Milliseconds",3);default:return this.clone()}},v.endOf=function(p){return this.startOf(p,!1)},v.$set=function(p,$){var y,T=E.p(p),O="set"+(this.$u?"UTC":""),I=(y={},y[u]=O+"Date",y[b]=O+"Date",y[l]=O+"Month",y[d]=O+"FullYear",y[c]=O+"Hours",y[a]=O+"Minutes",y[i]=O+"Seconds",y[o]=O+"Milliseconds",y)[T],P=T===u?this.$D+($-this.$W):$;if(T===l||T===d){var R=this.clone().set(b,1);R.$d[I](P),R.init(),this.$d=R.set(b,Math.min(this.$D,R.daysInMonth())).$d}else I&&this.$d[I](P);return this.init(),this},v.set=function(p,$){return this.clone().$set(p,$)},v.get=function(p){return this[E.p(p)]()},v.add=function(p,$){var y,T=this;p=Number(p);var O=E.p($),I=function(U){var H=N(T);return E.w(H.date(H.date()+Math.round(U*p)),T)};if(O===l)return this.set(l,this.$M+p);if(O===d)return this.set(d,this.$y+p);if(O===u)return I(1);if(O===f)return I(7);var P=(y={},y[a]=n,y[c]=s,y[i]=r,y)[O]||1,R=this.$d.getTime()+p*P;return E.w(R,this)},v.subtract=function(p,$){return this.add(-1*p,$)},v.format=function(p){var $=this,y=this.$locale();if(!this.isValid())return y.invalidDate||g;var T=p||"YYYY-MM-DDTHH:mm:ssZ",O=E.z(this),I=this.$H,P=this.$m,R=this.$M,U=y.weekdays,H=y.months,Se=y.meridiem,le=function(W,oe,We,st){return W&&(W[oe]||W($,T))||We[oe].slice(0,st)},ke=function(W){return E.s(I%12||12,W,"0")},he=Se||function(W,oe,We){var st=W<12?"AM":"PM";return We?st.toLowerCase():st};return T.replace(j,function(W,oe){return oe||function(We){switch(We){case"YY":return String($.$y).slice(-2);case"YYYY":return E.s($.$y,4,"0");case"M":return R+1;case"MM":return E.s(R+1,2,"0");case"MMM":return le(y.monthsShort,R,H,3);case"MMMM":return le(H,R);case"D":return $.$D;case"DD":return E.s($.$D,2,"0");case"d":return String($.$W);case"dd":return le(y.weekdaysMin,$.$W,U,2);case"ddd":return le(y.weekdaysShort,$.$W,U,3);case"dddd":return U[$.$W];case"H":return String(I);case"HH":return E.s(I,2,"0");case"h":return ke(1);case"hh":return ke(2);case"a":return he(I,P,!0);case"A":return he(I,P,!1);case"m":return String(P);case"mm":return E.s(P,2,"0");case"s":return String($.$s);case"ss":return E.s($.$s,2,"0");case"SSS":return E.s($.$ms,3,"0");case"Z":return O}return null}(W)||O.replace(":","")})},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(p,$,y){var T,O=this,I=E.p($),P=N(p),R=(P.utcOffset()-this.utcOffset())*n,U=this-P,H=function(){return E.m(O,P)};switch(I){case d:T=H()/12;break;case l:T=H();break;case h:T=H()/3;break;case f:T=(U-R)/6048e5;break;case u:T=(U-R)/864e5;break;case c:T=U/s;break;case a:T=U/n;break;case i:T=U/r;break;default:T=U}return y?T:E.a(T)},v.daysInMonth=function(){return this.endOf(l).$D},v.$locale=function(){return B[this.$L]},v.locale=function(p,$){if(!p)return this.$L;var y=this.clone(),T=ie(p,$,!0);return T&&(y.$L=T),y},v.clone=function(){return E.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},w}(),dr=nt.prototype;return N.prototype=dr,[["$ms",o],["$s",i],["$m",a],["$H",c],["$W",u],["$M",l],["$y",d],["$D",b]].forEach(function(w){dr[w[1]]=function(v){return this.$g(v,w[0],w[1])}}),N.extend=function(w,v){return w.$i||(w(v,nt,N),w.$i=!0),N},N.locale=ie,N.isDayjs=Ue,N.unix=function(w){return N(1e3*w)},N.en=B[k],N.Ls=B,N.p={},N})})(pu);var gu={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Cn,function(){var r="minute",n=/[+-]\d\d(?::?\d\d)?/g,s=/([+-]|\d\d)/g;return function(o,i,a){var c=i.prototype;a.utc=function(g){var _={date:g,utc:!0,args:arguments};return new i(_)},c.utc=function(g){var _=a(this.toDate(),{locale:this.$L,utc:!0});return g?_.add(this.utcOffset(),r):_},c.local=function(){return a(this.toDate(),{locale:this.$L,utc:!1})};var u=c.parse;c.parse=function(g){g.utc&&(this.$u=!0),this.$utils().u(g.$offset)||(this.$offset=g.$offset),u.call(this,g)};var f=c.init;c.init=function(){if(this.$u){var g=this.$d;this.$y=g.getUTCFullYear(),this.$M=g.getUTCMonth(),this.$D=g.getUTCDate(),this.$W=g.getUTCDay(),this.$H=g.getUTCHours(),this.$m=g.getUTCMinutes(),this.$s=g.getUTCSeconds(),this.$ms=g.getUTCMilliseconds()}else f.call(this)};var l=c.utcOffset;c.utcOffset=function(g,_){var j=this.$utils().u;if(j(g))return this.$u?0:j(this.$offset)?l.call(this):this.$offset;if(typeof g=="string"&&(g=function(k){k===void 0&&(k="");var B=k.match(n);if(!B)return null;var Oe=(""+B[0]).match(s)||["-",0,0],Ue=Oe[0],ie=60*+Oe[1]+ +Oe[2];return ie===0?0:Ue==="+"?ie:-ie}(g),g===null))return this;var S=Math.abs(g)<=16?60*g:g,L=this;if(_)return L.$offset=S,L.$u=g===0,L;if(g!==0){var G=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(L=this.local().add(S+G,r)).$offset=S,L.$x.$localOffset=G}else L=this.utc();return L};var h=c.format;c.format=function(g){var _=g||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return h.call(this,_)},c.valueOf=function(){var g=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*g},c.isUTC=function(){return!!this.$u},c.toISOString=function(){return this.toDate().toISOString()},c.toString=function(){return this.toDate().toUTCString()};var d=c.toDate;c.toDate=function(g){return g==="s"&&this.$offset?a(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var b=c.diff;c.diff=function(g,_,j){if(g&&this.$u===g.$u)return b.call(this,g,_,j);var S=this.local(),L=a(g).local();return b.call(S,L,_,j)}}})})(gu);var cr=(e=>(e.CONTAINER="container",e.PAGE="page",e.ROOT="app",e.PAGE_FRAGMENT="page-fragment",e))(cr||{}),lt=(e=>(e.COMP="comp",e.CODE="code",e.DATA_SOURCE="data-source",e))(lt||{}),fs=(e=>(e.CODE="code",e))(fs||{}),ht=(e=>(e.CODE="code",e.DATA_SOURCE_METHOD="data-source-method",e))(ht||{});const Ge=(e,t=[])=>{const r=[],n=function(s,o){if(!Array.isArray(o))return null;for(let i=0,a=o.length;i<a;i++){const c=o[i];if(r.push(c),"".concat(c.id)==="".concat(s))return c;if(c.items){const u=n(s,c.items);if(u)return u}r.pop()}return null};return n(e,t),r},gt=e=>Object.prototype.toString.call(e)==="[object Object]",ls=e=>{var t;return e?((t=e.type)==null?void 0:t.toLowerCase())===cr.PAGE:!1},mu=e=>{var t;return e?((t=e.type)==null?void 0:t.toLowerCase())===cr.PAGE_FRAGMENT:!1},ye=(e="",t={})=>(Array.isArray(e)?e:"".concat(e).replaceAll(/\[(\d+)\]/g,".$1").split(".")).reduce((n,s)=>{if(gt(n)||Array.isArray(n))return n[s]},t),Ht=(e,t,r={})=>du(r,e,t),Pt=(e,t=[])=>{const r=[],n=function(s,o){if(Array.isArray(o))for(let i=0,a=o.length;i<a;i++){const c=o[i],u=s.findIndex(f=>"".concat(f)==="".concat(c.id));u>-1&&(s.slice(u,1),r.push(c)),c.items&&n(s,c.items)}};return n(e,t),r},yu=(e={},t)=>Array.from(Object.values(e).reduce((r,n)=>{var s;return(((s=n[t])==null?void 0:s.keys)||[]).forEach(o=>r.add(o)),r},new Set)),Hr=(e={})=>Array.from(Object.values(e).reduce((t,r)=>(Object.keys(r).forEach(n=>{t.add(n)}),t),new Set)),hs=(e,t,r)=>{var a;const n=Ge(e.id,t),s=n.pop();let o=n.pop();if(r&&(o=Ge(r,t).pop()),!s)throw new Error("未找到目标节点");if(!o)throw new Error("未找到父节点");const i=(a=o.items)==null?void 0:a.findIndex(c=>c.id===s.id);o.items.splice(i,1,e)},ds="__magic__",ps=(e,t,r={},n)=>{let s=[];if(!n)s=yu(r,t.id);else{const o=r[n];s=(o==null?void 0:o[t.id].keys)||[]}return s.forEach(o=>{const i="".concat(o).replaceAll(/\[(\d+)\]/g,".$1").split("."),a=i.map((l,h)=>h<i.length-1?l:"".concat(ds).concat(l)),c=ye(o,t);let u=ye(a,t);typeof u>"u"&&(Ht(a.join("."),c,t),u=c);let f;try{f=e(u)}catch(l){console.error(l),f=""}Ht(o,f,t)}),t},gs=(e,t,r,n=[])=>{var s,o;switch(typeof t=="string"&&typeof r>"u"&&(r=""),e){case"is":return t===r;case"not":return t!==r;case"=":return t===r;case"!=":return t!==r;case">":return t>r;case">=":return t>=r;case"<":return t<r;case"<=":return t<=r;case"between":return n.length>1&&t>=n[0]&&t<=n[1];case"not_between":return n.length<2||t<n[0]||t>n[1];case"include":return(s=t==null?void 0:t.includes)==null?void 0:s.call(t,r);case"not_include":return typeof t>"u"||!((o=t.includes)!=null&&o.call(t,r))}return!1},ms=e=>{const t={},r={string:void 0,object:{},array:[],boolean:void 0,number:void 0,null:null,any:void 0};return e.forEach(n=>{if(typeof n.defaultValue<"u"){if(n.type==="array"&&!Array.isArray(n.defaultValue)){t[n.name]=r.array;return}if(n.type==="object"&&!gt(n.defaultValue)){if(typeof n.defaultValue=="string"){try{t[n.name]=JSON.parse(n.defaultValue)}catch(s){t[n.name]=r.object}return}t[n.name]=r.object;return}t[n.name]=tu(n.defaultValue);return}if(n.type==="object"){t[n.name]=n.fields?ms(n.fields):r.object;return}if(n.type){t[n.name]=r[n.type];return}t[n.name]=void 0}),t},mt="ds-field::",zr="ds-field-changed";var ae=(e=>(e.DEFAULT="default",e.CODE_BLOCK="code-block",e.DATA_SOURCE="data-source",e.DATA_SOURCE_METHOD="data-source-method",e.DATA_SOURCE_COND="data-source-cond",e))(ae||{});class Gr{constructor(t){m(this,"isTarget");m(this,"id");m(this,"name");m(this,"type",ae.DEFAULT);m(this,"deps",{});m(this,"isCollectByDefault");var r;this.isTarget=t.isTarget,this.id=t.id,this.name=t.name,this.isCollectByDefault=(r=t.isCollectByDefault)!=null?r:!0,t.type&&(this.type=t.type),t.initialDeps&&(this.deps=t.initialDeps)}updateDep({id:t,name:r,key:n,data:s}){const o=this.deps[t]||{name:r,keys:[]};o.name=r,o.data=s,this.deps[t]=o,o.keys.indexOf(n)===-1&&o.keys.push(n)}removeDep(t,r){if(typeof t>"u"){Object.keys(this.deps).forEach(s=>{delete this.deps[s]});return}const n=this.deps[t];if(n)if(r){const s=n.keys.indexOf(r);n.keys.splice(s,1),n.keys.length===0&&delete this.deps[t]}else delete this.deps[t]}hasDep(t,r){const n=this.deps[t];return!!(n!=null&&n.keys.find(s=>s===r))}destroy(){this.deps={}}}const bu=(e,t)=>typeof e=="string"&&e.includes("".concat(t))&&/\$\{([\s\S]+?)\}/.test(e),vu=(e,t)=>{if(!Array.isArray(e)||typeof e[0]!="string")return!1;const[r]=e,n=r.indexOf(mt);return n===-1?!1:r.substring(n+mt.length)===t},qr=(e,t,r)=>{Object.values(e).forEach(n=>{Object.values(n).forEach(s=>{r&&s.type!==r||t(s)})})};class $u{constructor(t){m(this,"targetsList",{});m(this,"childrenProp","items");m(this,"idProp","id");m(this,"nameProp","name");t!=null&&t.initialTargets&&(this.targetsList=t.initialTargets),t!=null&&t.childrenProp&&(this.childrenProp=t.childrenProp)}getTargetsList(){return this.targetsList}getTargets(t=ae.DEFAULT){return this.targetsList[t]||{}}addTarget(t){const r=this.getTargets(t.type)||{};this.targetsList[t.type]=r,r[t.id]=t}getTarget(t,r=ae.DEFAULT){return this.getTargets(r)[t]}hasTarget(t,r=ae.DEFAULT){return!!this.getTarget(t,r)}hasSpecifiedTypeTarget(t=ae.DEFAULT){return Object.keys(this.getTargets(t)).length>0}removeTarget(t,r=ae.DEFAULT){const n=this.getTargets(r);n[t]&&(n[t].destroy(),delete n[t])}removeTargets(t=ae.DEFAULT){const r=this.targetsList[t];if(r){for(const n of Object.values(r))n.destroy();delete this.targetsList[t]}}clearTargets(){Object.keys(this.targetsList).forEach(t=>{delete this.targetsList[t]})}collect(t,r={},n=!1,s){this.collectByCallback(t,s,({node:o,target:i})=>{this.removeTargetDep(i,o),this.collectItem(o,i,r,n)})}collectByCallback(t,r,n){qr(this.targetsList,s=>{!r&&!s.isCollectByDefault||t.forEach(o=>{n({node:o,target:s})})},r)}clear(t,r){let{targetsList:n}=this;r&&(n={[r]:this.getTargets(r)});const s=[];qr(n,o=>{t?t.forEach(i=>{o.removeDep(i[this.idProp]),Array.isArray(i[this.childrenProp])&&i[this.childrenProp].length&&!s.includes(i[this.idProp])&&(s.push(i[this.idProp]),this.clear(i[this.childrenProp]))}):o.removeDep()})}clearByType(t,r){this.clear(r,t)}collectItem(t,r,n={},s=!1){const o=(i,a="")=>{const c=(u,f)=>{const l=u===this.childrenProp,h=a?"".concat(a,".").concat(u):u;r.isTarget(h,f)?r.updateDep({id:t[this.idProp],name:"".concat(t[this.nameProp]||t[this.idProp]),data:n,key:h}):!l&&Array.isArray(f)?f.forEach((d,b)=>{gt(d)&&o(d,"".concat(h,"[").concat(b,"]"))}):gt(f)&&o(f,h),l&&s&&Array.isArray(f)&&f.forEach(d=>{this.collectItem(d,r,n,s)})};Object.entries(i).forEach(([u,f])=>{typeof f>"u"||f===""||c(u,f)})};o(t)}removeTargetDep(t,r,n){t.removeDep(r[this.idProp],n),typeof n>"u"&&Array.isArray(r[this.childrenProp])&&r[this.childrenProp].length&&r[this.childrenProp].forEach(s=>{this.removeTargetDep(t,s,n)})}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function _u(e,t,r,n){function s(o){return o instanceof r?o:new r(function(i){i(o)})}return new(r||(r=Promise))(function(o,i){function a(f){try{u(n.next(f))}catch(l){i(l)}}function c(f){try{u(n.throw(f))}catch(l){i(l)}}function u(f){f.done?o(f.value):s(f.value).then(a,c)}u((n=n.apply(e,[])).next())})}const de=[];function wu(e,t,r="*"){if(e===r)return!0;de.length=0;let n=0,s=0,o=0,i=0;for(let h=0,d=e.length;h<d;h+=1){const b=e[h];b===r&&(n+=1,h>i&&de.push(e.substring(i,h)),de.push(b),i=h+1)}if(i<e.length&&de.push(e.substring(i)),n?(s=e.length-n,o=1/0):o=s=e.length,de.length===0)return e===t;const a=t.length;if(a<s||a>o)return!1;let c=0,u=de.length-1,f=t.length-1,l=!1;for(;;){const h=de[u];if(u-=1,h===r)l=!0;else{const d=f+1-h.length,b=t.lastIndexOf(h,d);if(b===-1||b>d)return!1;if(l)f=b-1,l=!1;else{if(b!==d)return!1;f-=h.length}}if(c>u)break}return!0}class it{constructor(t,r,n,s=void 0){this.obj=t,this.delimiter=r,this.wildcard=n,this.is_match=s}shortMatch(t,r){if(t===r||t===this.wildcard)return!0;if(this.is_match)return this.is_match(t,r);const n=t.indexOf(this.wildcard);if(n>-1){const s=t.substr(n+1);if(n===0||r.substring(0,n)===t.substring(0,n)){const o=s.length;return o>0?r.substr(-o)===s:!0}}return!1}match(t,r){return this.is_match?this.is_match(t,r):t===r||t===this.wildcard||r===this.wildcard||this.shortMatch(t,r)||wu(t,r,this.wildcard)}handleArray(t,r,n,s,o={}){let i=t.indexOf(this.delimiter,n),a=!1;i===-1&&(a=!0,i=t.length);const c=t.substring(n,i);let u=0;for(const f of r){const l=u.toString(),h=s===""?l:s+this.delimiter+u;(c===this.wildcard||c===l||this.shortMatch(c,l))&&(a?o[h]=f:this.goFurther(t,f,i+1,h,o)),u++}return o}handleObject(t,r,n,s,o={}){let i=t.indexOf(this.delimiter,n),a=!1;i===-1&&(a=!0,i=t.length);const c=t.substring(n,i);for(let u in r){u=u.toString();const f=s===""?u:s+this.delimiter+u;(c===this.wildcard||c===u||this.shortMatch(c,u))&&(a?o[f]=r[u]:this.goFurther(t,r[u],i+1,f,o))}return o}goFurther(t,r,n,s,o={}){return Array.isArray(r)?this.handleArray(t,r,n,s,o):this.handleObject(t,r,n,s,o)}get(t){return this.goFurther(t,this.obj,0,"")}}class Ee{static get(t,r,n=!1){if(!r)return;let s=r;for(const o of t)if(o in s)s=s[o];else if(n)s[o]=Object.create({}),s=s[o];else return;return s}static set(t,r,n){if(!n)return;if(t.length===0){for(const a in n)delete n[a];for(const a in r)n[a]=r[a];return}const s=t.slice(),o=s.pop(),i=Ee.get(s,n,!0);return typeof i=="object"&&(i[o]=r),r}}let ee,yt=0,ot=null;function Nt(){return(ot===null||ot.buffer!==ee.memory.buffer)&&(ot=new Uint8Array(ee.memory.buffer)),ot}let dt=new TextEncoder("utf-8");const Tu=typeof dt.encodeInto=="function"?function(e,t){return dt.encodeInto(e,t)}:function(e,t){const r=dt.encode(e);return t.set(r),{read:e.length,written:r.length}};function Qr(e,t,r){if(r===void 0){const a=dt.encode(e),c=t(a.length);return Nt().subarray(c,c+a.length).set(a),yt=a.length,c}let n=e.length,s=t(n);const o=Nt();let i=0;for(;i<n;i++){const a=e.charCodeAt(i);if(a>127)break;o[s+i]=a}if(i!==n){i!==0&&(e=e.slice(i)),s=r(s,n,n=i+e.length*3);const a=Nt().subarray(s+i,s+n),c=Tu(e,a);i+=c.written}return yt=i,s}function Ou(e,t){var r=Qr(e,ee.__wbindgen_malloc,ee.__wbindgen_realloc),n=yt,s=Qr(t,ee.__wbindgen_malloc,ee.__wbindgen_realloc),o=yt,i=ee.is_match(r,n,s,o);return i!==0}async function Su(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}else{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}async function ys(e){const t={};(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:n}=await Su(await e,t);return ee=r.exports,ys.__wbindgen_wasm_module=n,ee}const je={only:[],source:"",debug:!1,data:void 0,queue:!1,force:!1};function ju(e,t){console.debug(e,t)}function Eu(){return{delimiter:".",debug:!1,extraDebug:!1,useMute:!0,notRecursive:";",param:":",wildcard:"*",experimentalMatch:!1,queue:!1,defaultBulkValue:!0,useCache:!1,useSplitCache:!1,useIndicesCache:!1,maxSimultaneousJobs:1e3,maxQueueRuns:1e3,log:ju,Promise}}function Yr(e){return e&&e.constructor?e.constructor.name==="Object":typeof e=="object"&&e!==null}class Au{constructor(t={},r={}){this.jobsRunning=0,this.updateQueue=[],this.subscribeQueue=[],this.listenersIgnoreCache=new WeakMap,this.is_match=null,this.destroyed=!1,this.queueRuns=0,this.groupId=0,this.namedGroups=[],this.numberGroups=[],this.traceId=0,this.traceMap=new Map,this.tracing=[],this.savedTrace=[],this.collection=null,this.collections=0,this.cache=new Map,this.splitCache=new Map,this.indices=new Map,this.indicesCount=new Map,this.lastExecs=new WeakMap,this.listeners=new Map,this.waitingListeners=new Map,this.options=Object.assign(Object.assign({},Eu()),r),this.data=t,this.id=0,this.options.useCache?(this.pathGet=this.cacheGet,this.pathSet=this.cacheSet):(this.pathGet=Ee.get,this.pathSet=Ee.set),r.Promise?this.resolved=r.Promise.resolve():this.resolved=Promise.resolve(),this.muted=new Set,this.mutedListeners=new Set,this.scan=new it(this.data,this.options.delimiter,this.options.wildcard),this.destroyed=!1}getDefaultListenerOptions(){return{bulk:!1,bulkValue:this.options.defaultBulkValue,debug:!1,source:"",data:void 0,queue:!1,group:!1}}cacheGet(t,r=this.data,n=!1){const s=t.join(this.options.delimiter),o=this.cache.get(s);if(o){const a=o.deref();if(a)return a}const i=Ee.get(t,r,n);return(Yr(i)||Array.isArray(i))&&this.cache.set(s,new WeakRef(i)),i}cacheSet(t,r,n=this.data){const s=t.join(this.options.delimiter);return Yr(r)||Array.isArray(r)?this.cache.set(s,new WeakRef(r)):this.cache.delete(s),Ee.set(t,r,n)}silentSet(t,r){return this.pathSet(this.split(t),r,this.data)}loadWasmMatcher(t){return _u(this,void 0,void 0,function*(){yield ys(t),this.is_match=Ou,this.scan=new it(this.data,this.options.delimiter,this.options.wildcard,this.is_match)})}same(t,r){return(["number","string","undefined","boolean"].includes(typeof t)||t===null)&&r===t}getListeners(){return this.listeners}destroy(){this.destroyed=!0,this.data=void 0,this.listeners=new Map,this.waitingListeners=new Map,this.updateQueue=[],this.jobsRunning=0}match(t,r,n=!0){return this.is_match?this.is_match(t,r):t===r||t===this.options.wildcard||r===this.options.wildcard?!0:!n&&this.getIndicesCount(this.options.delimiter,t)<this.getIndicesCount(this.options.delimiter,r)?!1:this.scan.match(t,r)}getIndicesOf(t,r){if(this.options.useIndicesCache&&this.indices.has(r))return this.indices.get(r);const n=t.length;if(n==0)return[];let s=0,o,i=[];for(;(o=r.indexOf(t,s))>-1;)i.push(o),s=o+n;return this.options.useIndicesCache&&this.indices.set(r,i),i}getIndicesCount(t,r){if(this.options.useIndicesCache&&this.indicesCount.has(r))return this.indicesCount.get(r);const n=t.length;if(n==0)return 0;let s=0,o,i=0;for(;(o=r.indexOf(t,s))>-1;)i++,s=o+n;return this.options.useIndicesCache&&this.indicesCount.set(r,i),i}cutPath(t,r){if(r==="")return"";if(t=this.cleanNotRecursivePath(t),r=this.cleanNotRecursivePath(r),t===r)return t;const n=this.getIndicesCount(this.options.delimiter,r),s=this.getIndicesOf(this.options.delimiter,t);return t.substring(0,s[n])}trimPath(t){return t=this.cleanNotRecursivePath(t),t.charAt(0)===this.options.delimiter?t.substr(1):t}split(t){if(t==="")return[];if(!this.options.useSplitCache)return t.split(this.options.delimiter);const r=this.splitCache.get(t);if(r)return r.slice();const n=t.split(this.options.delimiter);return this.splitCache.set(t,n.slice()),n}isWildcard(t){return t.includes(this.options.wildcard)||this.hasParams(t)}isNotRecursive(t){return t.endsWith(this.options.notRecursive)}cleanNotRecursivePath(t){return this.isNotRecursive(t)?t.substring(0,t.length-1):t}hasParams(t){return t.includes(this.options.param)}getParamsInfo(t){let r={replaced:"",original:t,params:{}},n=0,s=[];for(const o of this.split(t)){r.params[n]={original:o,replaced:"",name:""};const i=new RegExp("\\".concat(this.options.param,"([^\\").concat(this.options.delimiter,"\\").concat(this.options.param,"]+)"),"g");let a=i.exec(o);if(a)r.params[n].name=a[1];else{delete r.params[n],s.push(o),n++;continue}i.lastIndex=0,r.params[n].replaced=o.replace(i,this.options.wildcard),s.push(r.params[n].replaced),n++}return r.replaced=s.join(this.options.delimiter),r}getParams(t,r){if(!t)return;const n=this.split(r),s={};for(const o in t.params){const i=t.params[o];s[i.name]=n[o]}return s}waitForAll(t,r){const n={};for(let s of t)n[s]={dirty:!1},this.hasParams(s)&&(n[s].paramsInfo=this.getParamsInfo(s)),n[s].isWildcard=this.isWildcard(s),n[s].isRecursive=!this.isNotRecursive(s);return this.waitingListeners.set(t,{fn:r,paths:n}),r(n),function(){this.waitingListeners.delete(t)}}executeWaitingListeners(t){if(!this.destroyed)for(const r of this.waitingListeners.values()){const{fn:n,paths:s}=r;let o=0,i=0;for(let a in s){const c=s[a];let u=!1;c.isRecursive&&(t=this.cutPath(t,a)),c.isWildcard&&this.match(a,t)&&(u=!0),t===a&&(u=!0),u&&(c.dirty=!0),c.dirty&&o++,i++}o===i&&n(s)}}subscribeAll(t,r,n=this.getDefaultListenerOptions()){if(this.destroyed)return()=>{};let s=[],o=0,i=null;typeof n.group=="boolean"&&n.group?(this.groupId++,i=this.groupId,n.bulk=!0):typeof n.group=="string"&&(n.bulk=!0,i=n.group);for(const a of t)s.push(this.subscribe(a,r,n,{all:t,index:o,groupId:i})),o++;return function(){for(const c of s)c()}}getCleanListenersCollection(t={}){return Object.assign({listeners:new Map,isRecursive:!1,isWildcard:!1,hasParams:!1,match:void 0,paramsInfo:void 0,path:void 0,originalPath:void 0,count:0},t)}getCleanListener(t,r=this.getDefaultListenerOptions()){return{fn:t,options:Object.assign(Object.assign({},this.getDefaultListenerOptions()),r),groupId:null}}getListenerCollectionMatch(t,r,n){t=this.cleanNotRecursivePath(t);const s=this;return function(i,a=!1){let c=t;return r?i=s.cutPath(i,t):c=s.cutPath(s.cleanNotRecursivePath(t),i),a&&console.log("[getListenerCollectionMatch]",{listenerPath:t,scopedListenerPath:c,path:i,isRecursive:r,isWildcard:n}),n&&s.match(c,i,r)?!0:c===i}}getListenersCollection(t,r){if(this.listeners.has(t)){let a=this.listeners.get(t);return a.listeners.set(++this.id,r),r.id=this.id,a}const n=this.hasParams(t);let s;n&&(s=this.getParamsInfo(t));let o={isRecursive:!this.isNotRecursive(t),isWildcard:this.isWildcard(t),hasParams:n,paramsInfo:s,originalPath:t,path:n?s.replaced:t};o.isRecursive||(o.path=this.cleanNotRecursivePath(o.path));let i=this.getCleanListenersCollection(Object.assign(Object.assign({},o),{match:this.getListenerCollectionMatch(o.path,o.isRecursive,o.isWildcard)}));return this.id++,i.listeners.set(this.id,r),r.id=this.id,this.listeners.set(o.originalPath,i),i}subscribe(t,r,n=this.getDefaultListenerOptions(),s={all:[t],index:0,groupId:null}){if(this.destroyed)return()=>{};this.jobsRunning++;const o="subscribe";let i=this.getCleanListener(r,n);n.group&&(n.bulk=!0,typeof n.group=="string"?i.groupId=n.group:s.groupId&&(i.groupId=s.groupId)),this.listenersIgnoreCache.set(i,{truthy:[],falsy:[]});const a=this.getListenersCollection(t,i);n.debug&&console.log("[subscribe]",{listenerPath:t,options:n}),a.count++;let c=!0;if(i.groupId&&(typeof i.groupId=="string"?this.namedGroups.includes(i.groupId)?c=!1:this.namedGroups.push(i.groupId):typeof i.groupId=="number"&&(this.numberGroups.includes(i.groupId)?c=!1:this.numberGroups.push(i.groupId))),c){const u=this.cleanNotRecursivePath(a.path),f=this.split(u);if(!a.isWildcard)!this.isMuted(u)&&!this.isMuted(r)&&r(this.pathGet(f,this.data),{type:o,listener:i,listenersCollection:a,path:{listener:t,update:void 0,resolved:this.cleanNotRecursivePath(t)},params:this.getParams(a.paramsInfo,u),options:n});else{const l=this.scan.get(u);if(n.bulk){const h=[];for(const d in l)this.isMuted(d)||h.push({path:d,params:this.getParams(a.paramsInfo,d),value:l[d]});this.isMuted(r)||r(h,{type:o,listener:i,listenersCollection:a,path:{listener:t,update:void 0,resolved:void 0},options:n,params:void 0})}else for(const h in l)!this.isMuted(h)&&!this.isMuted(r)&&r(l[h],{type:o,listener:i,listenersCollection:a,path:{listener:t,update:void 0,resolved:this.cleanNotRecursivePath(h)},params:this.getParams(a.paramsInfo,h),options:n})}}return this.debugSubscribe(i,a,t),this.jobsRunning--,this.unsubscribe(t,this.id)}unsubscribe(t,r){const n=this.listeners,s=n.get(t);return function(){s.listeners.delete(r),s.count--,s.count===0&&n.delete(t)}}runQueuedListeners(){if(!this.destroyed&&this.subscribeQueue.length!==0)if(this.jobsRunning===0){this.queueRuns=0;const t=[...this.subscribeQueue];for(let r=0,n=t.length;r<n;r++)t[r]();this.subscribeQueue.length=0}else{if(this.queueRuns++,this.queueRuns>=this.options.maxQueueRuns)throw this.queueRuns=0,new Error("Maximal number of queue runs exhausted.");Promise.resolve().then(()=>this.runQueuedListeners()).catch(t=>{throw t})}}getQueueNotifyListeners(t,r=[]){for(const n in t){if(this.isMuted(n))continue;let{single:s,bulk:o}=t[n];for(const i of s){let a=!1,c=i.listener.id+":"+i.eventInfo.path.resolved;i.eventInfo.path.resolved||(c=i.listener.id+":"+i.eventInfo.path.listener);for(const f of r)if(c===f.resolvedIdPath){a=!0;break}if(a)continue;const u=this.debugTime(i);if(!this.isMuted(i.listener.fn))if(i.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push(()=>{i.listener.fn(i.value?i.value():void 0,i.eventInfo)});else{let f=i.listener.id+":"+i.eventInfo.path.resolved;i.eventInfo.path.resolved||(f=i.listener.id+":"+i.eventInfo.path.listener),r.push({id:i.listener.id,resolvedPath:i.eventInfo.path.resolved,resolvedIdPath:f,originalFn:i.listener.fn,fn:()=>{i.listener.fn(i.value?i.value():void 0,i.eventInfo)},options:i.listener.options,groupId:i.listener.groupId})}this.debugListener(u,i)}for(const i of o){let a=!1;for(const f of r)if(f.id===i.listener.id){a=!0;break}if(a)continue;const c=this.debugTime(i),u=[];for(const f of i.value)u.push(Object.assign(Object.assign({},f),{value:f.value?f.value():void 0}));if(!this.isMuted(i.listener.fn))if(i.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push(()=>this.jobsRunning?!1:(i.listener.fn(u,i.eventInfo),!0));else{let f=i.listener.id+":"+i.eventInfo.path.resolved;i.eventInfo.path.resolved||(f=i.listener.id+":"+i.eventInfo.path.listener),r.push({id:i.listener.id,resolvedPath:i.eventInfo.path.resolved,resolvedIdPath:f,originalFn:i.listener.fn,fn:()=>{i.listener.fn(u,i.eventInfo)},options:i.listener.options,groupId:i.listener.groupId})}this.debugListener(c,i)}}return Promise.resolve().then(()=>this.runQueuedListeners()),r}shouldIgnore(t,r){if(!t.options.ignore)return!1;for(const n of t.options.ignore){if(r.startsWith(n)||this.is_match&&this.is_match(n,r))return!0;{const s=this.cutPath(r,n);if(this.match(n,s))return!0}}return!1}getSubscribedListeners(t,r,n,s="update",o=null){n=Object.assign(Object.assign({},je),n);const i={};for(let[a,c]of this.listeners)if(c.match(t)){i[a]={single:[],bulk:[],bulkData:[]};const u=c.paramsInfo?this.getParams(c.paramsInfo,t):void 0,f=this.cutPath(t,a),h=c.isRecursive||c.isWildcard?()=>this.get(f):()=>r,d=[{value:h,path:t,params:u}];for(const b of c.listeners.values()){if(this.shouldIgnore(b,t)){b.options.debug&&console.log("[getSubscribedListeners] Listener was not fired because it was ignored.",{listener:b,listenersCollection:c});continue}b.options.bulk?i[a].bulk.push({listener:b,listenersCollection:c,eventInfo:{type:s,listener:b,path:{listener:a,update:o||t,resolved:void 0},params:u,options:n},value:d}):i[a].single.push({listener:b,listenersCollection:c,eventInfo:{type:s,listener:b,path:{listener:a,update:o||t,resolved:this.cleanNotRecursivePath(t)},params:u,options:n},value:h})}}else if(this.options.extraDebug){let u=!1;for(const f of c.listeners.values())f.options.debug&&(u=!0,console.log("[getSubscribedListeners] Listener was not fired because there was no match.",{listener:f,listenersCollection:c,updatePath:t}));u&&c.match(t,!0)}return i}notifySubscribedListeners(t,r,n,s="update",o=null){return this.getQueueNotifyListeners(this.getSubscribedListeners(t,r,n,s,o))}useBulkValue(t){for(const[r,n]of t.listeners)if(n.options.bulk&&n.options.bulkValue||!n.options.bulk)return!0;return!1}getNestedListeners(t,r,n,s="update",o=null){const i={},a={};for(let[c,u]of this.listeners){if(!u.isRecursive)continue;const f=this.cutPath(c,t);if(this.match(f,t)){i[c]={single:[],bulk:[]};const l=this.trimPath(c.substr(f.length)),h=this.useBulkValue(u);let d;h&&(d=a[l]?a[l]:new it(r,this.options.delimiter,this.options.wildcard).get(l),a[l]=d);const b=u.paramsInfo?this.getParams(u.paramsInfo,t):void 0,g=[],_={};for(const[j,S]of u.listeners)if(h)for(const L in d){const G=()=>d[L],k=[t,L].join(this.options.delimiter),B={type:s,listener:S,listenersCollection:u,path:{listener:c,update:o||t,resolved:this.cleanNotRecursivePath(k)},params:b,options:n};this.shouldIgnore(S,t)||(S.options.bulk?(g.push({value:G,path:k,params:b}),_[j]=S):i[c].single.push({listener:S,listenersCollection:u,eventInfo:B,value:G}))}else{const L={type:s,listener:S,listenersCollection:u,path:{listener:c,update:o||t,resolved:void 0},params:b,options:n};if(this.shouldIgnore(S,t))continue;S.options.bulk?(g.push({value:void 0,path:void 0,params:b}),_[j]=S):i[c].single.push({listener:S,listenersCollection:u,eventInfo:L,value:void 0})}for(const j in _){const S=_[j],L={type:s,listener:S,listenersCollection:u,path:{listener:c,update:t,resolved:void 0},options:n,params:b};i[c].bulk.push({listener:S,listenersCollection:u,eventInfo:L,value:g})}}else if(this.options.extraDebug)for(const l of u.listeners.values())l.options.debug&&console.log("[getNestedListeners] Listener was not fired because there was no match.",{listener:l,listenersCollection:u,currentCutPath:f,updatePath:t})}return i}notifyNestedListeners(t,r,n,s="update",o,i=null){return this.getQueueNotifyListeners(this.getNestedListeners(t,r,n,s,i),o)}getNotifyOnlyListeners(t,r,n,s="update",o=null){const i={};if(typeof n.only!="object"||!Array.isArray(n.only)||typeof n.only[0]>"u"||!this.canBeNested(r))return i;for(const a of n.only){const c=new it(r,this.options.delimiter,this.options.wildcard).get(a);i[a]={bulk:[],single:[]};for(const u in c){const f=t+this.options.delimiter+u;for(const[l,h]of this.listeners){const d=h.paramsInfo?this.getParams(h.paramsInfo,f):void 0;if(this.match(l,f)){const b=()=>c[u],g=[{value:b,path:f,params:d}];for(const _ of h.listeners.values()){const j={type:s,listener:_,listenersCollection:h,path:{listener:l,update:o||t,resolved:this.cleanNotRecursivePath(f)},params:d,options:n};this.shouldIgnore(_,t)||(_.options.bulk?i[a].bulk.some(S=>S.listener===_)||i[a].bulk.push({listener:_,listenersCollection:h,eventInfo:j,value:g}):i[a].single.push({listener:_,listenersCollection:h,eventInfo:j,value:b}))}}}}}return i}runQueue(t){const r=[];for(const n of t)n.options.group?r.includes(n.groupId)||(n.fn(),r.push(n.groupId)):n.fn()}sortAndRunQueue(t,r){t.sort(function(n,s){return n.id-s.id}),this.options.debug&&console.log("[deep-state-observer] queue for ".concat(r),t),this.runQueue(t)}notifyOnly(t,r,n,s="update",o=""){const i=this.getQueueNotifyListeners(this.getNotifyOnlyListeners(t,r,n,s,o));this.sortAndRunQueue(i,t)}canBeNested(t){return typeof t=="object"&&t!==null}getUpdateValues(t,r){let n=r;return typeof r=="function"&&(n=r(t)),{newValue:n,oldValue:t}}wildcardNotify(t,r){let n=[];for(const s of t)this.getQueueNotifyListeners(s,n);for(const s of r)this.executeWaitingListeners(s);return this.jobsRunning--,n}wildcardUpdate(t,r,n=je,s=!1){++this.jobsRunning,n=Object.assign(Object.assign({},je),n);const o=this.scan.get(t),i={};for(const f in o){const l=this.split(f),{oldValue:h,newValue:d}=this.getUpdateValues(o[f],r);(!this.same(d,h)||n.force)&&(this.pathSet(l,d,this.data),i[f]=d)}const a=[],c=[];for(const f in i){const l=i[f];n.only.length?a.push(this.getNotifyOnlyListeners(f,l,n,"update",t)):(a.push(this.getSubscribedListeners(f,l,n,"update",t)),this.canBeNested(l)&&a.push(this.getNestedListeners(f,l,n,"update",t))),n.debug&&this.options.log("Wildcard update",{path:f,newValue:l}),c.push(f)}if(s){const f=this;return function(){const l=f.wildcardNotify(a,c);f.sortAndRunQueue(l,t)}}const u=this.wildcardNotify(a,c);this.sortAndRunQueue(u,t)}runUpdateQueue(){if(!this.destroyed)for(;this.updateQueue.length&&this.updateQueue.length<this.options.maxSimultaneousJobs;){const t=this.updateQueue.shift();t.options.queue=!1,this.update(t.updatePath,t.fnOrValue,t.options,t.multi)}}updateNotify(t,r,n){const s=this.notifySubscribedListeners(t,r,n);this.canBeNested(r)&&this.notifyNestedListeners(t,r,n,"update",s),this.sortAndRunQueue(s,t),this.executeWaitingListeners(t)}updateNotifyAll(t){let r=[];for(const n of t){const s=n.newValue;if(this.tracing.length){const o=this.tracing[this.tracing.length-1],i=this.traceMap.get(o);i.changed.push({traceId:o,updatePath:n.updatePath,fnOrValue:s,options:n.options}),this.traceMap.set(o,i)}r=r.concat(this.notifySubscribedListeners(n.updatePath,s,n.options)),this.canBeNested(n.newValue)&&this.notifyNestedListeners(n.updatePath,s,n.options,"update",r)}this.runQueue(r)}updateNotifyOnly(t,r,n){this.notifyOnly(t,r,n),this.executeWaitingListeners(t)}update(t,r,n=Object.assign({},je),s=!1){if(this.destroyed)return;if(this.collection)return this.collection.update(t,r,n);if(this.tracing.length){const f=this.tracing[this.tracing.length-1],l=this.traceMap.get(f);l.changed.push({traceId:f,updatePath:t,fnOrValue:r,options:n}),this.traceMap.set(f,l)}const o=this.jobsRunning;if((this.options.queue||n.queue)&&o){if(o>this.options.maxSimultaneousJobs)throw new Error("Maximal simultaneous jobs limit reached.");this.updateQueue.push({updatePath:t,fnOrValue:r,options:n,multi:s});const f=Promise.resolve().then(()=>{this.runUpdateQueue()});return s?function(){return f}:f}if(this.isWildcard(t))return this.wildcardUpdate(t,r,n,s);++this.jobsRunning;const i=this.split(t),a=this.pathGet(i,this.data);let{oldValue:c,newValue:u}=this.getUpdateValues(a,r);if(n.debug&&this.options.log("Updating ".concat(t," ").concat(n.source?"from ".concat(n.source):""),{oldValue:c,newValue:u}),this.same(u,c)&&!n.force)return--this.jobsRunning,s?function(){return u}:u;if(this.pathSet(i,u,this.data),n=Object.assign(Object.assign({},je),n),n.only===null)return--this.jobsRunning,s?function(){}:u;if(n.only.length){if(--this.jobsRunning,s){const f=this;return function(){return f.updateNotifyOnly(t,u,n)}}return this.updateNotifyOnly(t,u,n),u}if(s){--this.jobsRunning;const f=this;return function(){return f.updateNotify(t,u,n)}}return this.updateNotify(t,u,n),--this.jobsRunning,u}multi(t=!1){if(this.destroyed)return{update(){return this},done(){},getStack(){return[]}};if(this.collection)return this.collection;const r=this,n=[],s=[];return{update(i,a,c=je){if(t){const u=r.split(i);let f=a;const l=r.pathGet(u,r.data);typeof f=="function"&&(f=f(l)),r.pathSet(u,f,r.data),n.push({updatePath:i,newValue:f,options:c})}else s.push(r.update(i,a,c,!0));return this},done(){if(r.collections===0){if(t)r.updateNotifyAll(n);else for(const i of s)i();n.length=0}},getStack(){return n}}}collect(){return this.collections++,this.collection||(this.collection=this.multi(!0)),this.collection}executeCollected(){if(this.collections--,this.collections===0&&this.collection){const t=this.collection;this.collection=null,t.done()}}getCollectedCount(){return this.collections}getCollectedStack(){return this.collection?this.collection.getStack():[]}get(t=void 0){if(!this.destroyed)return t===void 0||t===""?this.data:this.isWildcard(t)?this.scan.get(t):this.pathGet(this.split(t),this.data)}last(t){let r=this.lastExecs.get(t);r||(r={calls:0},this.lastExecs.set(t,r));const n=++r.calls;this.resolved.then(()=>{n===r.calls&&(this.lastExecs.set(t,{calls:0}),t())})}isMuted(t){if(!this.options.useMute)return!1;if(typeof t=="function")return this.isMutedListener(t);for(const r of this.muted){const n=!this.isNotRecursive(r),s=this.trimPath(r);if(this.match(t,s)||this.match(s,t))return!0;if(n){const o=this.cutPath(s,t);if(this.match(o,r)||this.match(r,o))return!0}}return!1}isMutedListener(t){return this.mutedListeners.has(t)}mute(t){if(typeof t=="function")return this.mutedListeners.add(t);this.muted.add(t)}unmute(t){if(typeof t=="function")return this.mutedListeners.delete(t);this.muted.delete(t)}debugSubscribe(t,r,n){t.options.debug&&this.options.log("listener subscribed",{listenerPath:n,listener:t,listenersCollection:r})}debugListener(t,r){(r.eventInfo.options.debug||r.listener.options.debug)&&this.options.log("Listener fired",{time:Date.now()-t,info:r})}debugTime(t){return t.listener.options.debug||t.eventInfo.options.debug?Date.now():0}startTrace(t,r=null){this.traceId++;const n=this.traceId+":"+t;return this.traceMap.set(n,{id:n,sort:this.traceId,stack:this.tracing.map(s=>s),additionalData:r,changed:[]}),this.tracing.push(n),n}stopTrace(t){const r=this.traceMap.get(t);return this.tracing.pop(),this.traceMap.delete(t),r}saveTrace(t){const r=this.traceMap.get(t);return this.tracing.pop(),this.traceMap.delete(t),this.savedTrace.push(r),r}getSavedTraces(){const t=this.savedTrace.map(r=>r);return t.sort((r,n)=>r.sort-n.sort),this.savedTrace=[],t}}var bs=typeof global=="object"&&global&&global.Object===Object&&global,Iu=typeof self=="object"&&self&&self.Object===Object&&self,X=bs||Iu||Function("return this")(),V=X.Symbol,vs=Object.prototype,Cu=vs.hasOwnProperty,Du=vs.toString,He=V?V.toStringTag:void 0;function Mu(e){var t=Cu.call(e,He),r=e[He];try{e[He]=void 0;var n=!0}catch(o){}var s=Du.call(e);return n&&(t?e[He]=r:delete e[He]),s}var xu=Object.prototype,Lu=xu.toString;function Pu(e){return Lu.call(e)}var Nu="[object Null]",Ru="[object Undefined]",Kr=V?V.toStringTag:void 0;function fe(e){return e==null?e===void 0?Ru:Nu:Kr&&Kr in Object(e)?Mu(e):Pu(e)}function ne(e){return e!=null&&typeof e=="object"}var Fu="[object Symbol]";function Uu(e){return typeof e=="symbol"||ne(e)&&fe(e)==Fu}function $s(e,t){for(var r=-1,n=e==null?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var rt=Array.isArray,ku=1/0,Vr=V?V.prototype:void 0,Jr=Vr?Vr.toString:void 0;function _s(e){if(typeof e=="string")return e;if(rt(e))return $s(e,_s)+"";if(Uu(e))return Jr?Jr.call(e):"";var t=e+"";return t=="0"&&1/e==-ku?"-0":t}function Re(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function ws(e){return e}var Wu="[object AsyncFunction]",Bu="[object Function]",Hu="[object GeneratorFunction]",zu="[object Proxy]";function Ts(e){if(!Re(e))return!1;var t=fe(e);return t==Bu||t==Hu||t==Wu||t==zu}var Rt=X["__core-js_shared__"],Xr=function(){var e=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Gu(e){return!!Xr&&Xr in e}var qu=Function.prototype,Qu=qu.toString;function _e(e){if(e!=null){try{return Qu.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var Yu=/[\\^$.*+?()[\]{}|]/g,Ku=/^\[object .+?Constructor\]$/,Vu=Function.prototype,Ju=Object.prototype,Xu=Vu.toString,Zu=Ju.hasOwnProperty,ef=RegExp("^"+Xu.call(Zu).replace(Yu,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function tf(e){if(!Re(e)||Gu(e))return!1;var t=Ts(e)?ef:Ku;return t.test(_e(e))}function rf(e,t){return e==null?void 0:e[t]}function we(e,t){var r=rf(e,t);return tf(r)?r:void 0}var zt=we(X,"WeakMap"),Zr=Object.create,nf=function(){function e(){}return function(t){if(!Re(t))return{};if(Zr)return Zr(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function Os(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function sf(){}var of=800,af=16,cf=Date.now;function uf(e){var t=0,r=0;return function(){var n=cf(),s=af-(n-r);if(r=n,s>0){if(++t>=of)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function ff(e){return function(){return e}}var bt=function(){try{var e=we(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),lf=bt?function(e,t){return bt(e,"toString",{configurable:!0,enumerable:!1,value:ff(t),writable:!0})}:ws,hf=uf(lf);function df(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}function pf(e,t,r,n){for(var s=e.length,o=r+-1;++o<s;)if(t(e[o],o,e))return o;return-1}function gf(e){return e!==e}function mf(e,t,r){for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return-1}function yf(e,t,r){return t===t?mf(e,t,r):pf(e,gf,r)}function bf(e,t){var r=e==null?0:e.length;return!!r&&yf(e,t,0)>-1}var vf=9007199254740991,$f=/^(?:0|[1-9]\d*)$/;function Ss(e,t){var r=typeof e;return t=t==null?vf:t,!!t&&(r=="number"||r!="symbol"&&$f.test(e))&&e>-1&&e%1==0&&e<t}function js(e,t,r){t=="__proto__"&&bt?bt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function At(e,t){return e===t||e!==e&&t!==t}var _f=Object.prototype,wf=_f.hasOwnProperty;function Es(e,t,r){var n=e[t];(!(wf.call(e,t)&&At(n,r))||r===void 0&&!(t in e))&&js(e,t,r)}function Tf(e,t,r,n){var s=!r;r||(r={});for(var o=-1,i=t.length;++o<i;){var a=t[o],c=n?n(r[a],e[a],a,r,e):void 0;c===void 0&&(c=e[a]),s?js(r,a,c):Es(r,a,c)}return r}var en=Math.max;function Of(e,t,r){return t=en(t===void 0?e.length-1:t,0),function(){for(var n=arguments,s=-1,o=en(n.length-t,0),i=Array(o);++s<o;)i[s]=n[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=n[s];return a[t]=r(i),Os(e,this,a)}}function ur(e,t){return hf(Of(e,t,ws),e+"")}var Sf=9007199254740991;function As(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Sf}function It(e){return e!=null&&As(e.length)&&!Ts(e)}function jf(e,t,r){if(!Re(r))return!1;var n=typeof t;return(n=="number"?It(r)&&Ss(t,r.length):n=="string"&&t in r)?At(r[t],e):!1}function Ef(e){return ur(function(t,r){var n=-1,s=r.length,o=s>1?r[s-1]:void 0,i=s>2?r[2]:void 0;for(o=e.length>3&&typeof o=="function"?(s--,o):void 0,i&&jf(r[0],r[1],i)&&(o=s<3?void 0:o,s=1),t=Object(t);++n<s;){var a=r[n];a&&e(t,a,n,o)}return t})}var Af=Object.prototype;function fr(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Af;return e===r}function If(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var Cf="[object Arguments]";function tn(e){return ne(e)&&fe(e)==Cf}var Is=Object.prototype,Df=Is.hasOwnProperty,Mf=Is.propertyIsEnumerable,Cs=tn(function(){return arguments}())?tn:function(e){return ne(e)&&Df.call(e,"callee")&&!Mf.call(e,"callee")};function xf(){return!1}var Ds=typeof exports=="object"&&exports&&!exports.nodeType&&exports,rn=Ds&&typeof module=="object"&&module&&!module.nodeType&&module,Lf=rn&&rn.exports===Ds,nn=Lf?X.Buffer:void 0,Pf=nn?nn.isBuffer:void 0,Ms=Pf||xf,Nf="[object Arguments]",Rf="[object Array]",Ff="[object Boolean]",Uf="[object Date]",kf="[object Error]",Wf="[object Function]",Bf="[object Map]",Hf="[object Number]",zf="[object Object]",Gf="[object RegExp]",qf="[object Set]",Qf="[object String]",Yf="[object WeakMap]",Kf="[object ArrayBuffer]",Vf="[object DataView]",Jf="[object Float32Array]",Xf="[object Float64Array]",Zf="[object Int8Array]",el="[object Int16Array]",tl="[object Int32Array]",rl="[object Uint8Array]",nl="[object Uint8ClampedArray]",sl="[object Uint16Array]",il="[object Uint32Array]",x={};x[Jf]=x[Xf]=x[Zf]=x[el]=x[tl]=x[rl]=x[nl]=x[sl]=x[il]=!0;x[Nf]=x[Rf]=x[Kf]=x[Ff]=x[Vf]=x[Uf]=x[kf]=x[Wf]=x[Bf]=x[Hf]=x[zf]=x[Gf]=x[qf]=x[Qf]=x[Yf]=!1;function ol(e){return ne(e)&&As(e.length)&&!!x[fe(e)]}function lr(e){return function(t){return e(t)}}var xs=typeof exports=="object"&&exports&&!exports.nodeType&&exports,qe=xs&&typeof module=="object"&&module&&!module.nodeType&&module,al=qe&&qe.exports===xs,Ft=al&&bs.process,Me=function(){try{var e=qe&&qe.require&&qe.require("util").types;return e||Ft&&Ft.binding&&Ft.binding("util")}catch(t){}}(),sn=Me&&Me.isTypedArray,cl=sn?lr(sn):ol,ul=Object.prototype,fl=ul.hasOwnProperty;function Ls(e,t){var r=rt(e),n=!r&&Cs(e),s=!r&&!n&&Ms(e),o=!r&&!n&&!s&&cl(e),i=r||n||s||o,a=i?If(e.length,String):[],c=a.length;for(var u in e)(t||fl.call(e,u))&&!(i&&(u=="length"||s&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Ss(u,c)))&&a.push(u);return a}function Ps(e,t){return function(r){return e(t(r))}}var ll=Ps(Object.keys,Object),hl=Object.prototype,dl=hl.hasOwnProperty;function pl(e){if(!fr(e))return ll(e);var t=[];for(var r in Object(e))dl.call(e,r)&&r!="constructor"&&t.push(r);return t}function Ns(e){return It(e)?Ls(e):pl(e)}function gl(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var ml=Object.prototype,yl=ml.hasOwnProperty;function bl(e){if(!Re(e))return gl(e);var t=fr(e),r=[];for(var n in e)n=="constructor"&&(t||!yl.call(e,n))||r.push(n);return r}function vl(e){return It(e)?Ls(e,!0):bl(e)}var on=Ef(function(e,t,r,n){Tf(t,vl(t),e,n)}),Ke=we(Object,"create");function $l(){this.__data__=Ke?Ke(null):{},this.size=0}function _l(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var wl="__lodash_hash_undefined__",Tl=Object.prototype,Ol=Tl.hasOwnProperty;function Sl(e){var t=this.__data__;if(Ke){var r=t[e];return r===wl?void 0:r}return Ol.call(t,e)?t[e]:void 0}var jl=Object.prototype,El=jl.hasOwnProperty;function Al(e){var t=this.__data__;return Ke?t[e]!==void 0:El.call(t,e)}var Il="__lodash_hash_undefined__";function Cl(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Ke&&t===void 0?Il:t,this}function be(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}be.prototype.clear=$l;be.prototype.delete=_l;be.prototype.get=Sl;be.prototype.has=Al;be.prototype.set=Cl;function Dl(){this.__data__=[],this.size=0}function Ct(e,t){for(var r=e.length;r--;)if(At(e[r][0],t))return r;return-1}var Ml=Array.prototype,xl=Ml.splice;function Ll(e){var t=this.__data__,r=Ct(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():xl.call(t,r,1),--this.size,!0}function Pl(e){var t=this.__data__,r=Ct(t,e);return r<0?void 0:t[r][1]}function Nl(e){return Ct(this.__data__,e)>-1}function Rl(e,t){var r=this.__data__,n=Ct(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function se(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}se.prototype.clear=Dl;se.prototype.delete=Ll;se.prototype.get=Pl;se.prototype.has=Nl;se.prototype.set=Rl;var Ve=we(X,"Map");function Fl(){this.size=0,this.__data__={hash:new be,map:new(Ve||se),string:new be}}function Ul(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Dt(e,t){var r=e.__data__;return Ul(t)?r[typeof t=="string"?"string":"hash"]:r.map}function kl(e){var t=Dt(this,e).delete(e);return this.size-=t?1:0,t}function Wl(e){return Dt(this,e).get(e)}function Bl(e){return Dt(this,e).has(e)}function Hl(e,t){var r=Dt(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function Te(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Te.prototype.clear=Fl;Te.prototype.delete=kl;Te.prototype.get=Wl;Te.prototype.has=Bl;Te.prototype.set=Hl;function Rs(e){return e==null?"":_s(e)}function Fs(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}var an=V?V.isConcatSpreadable:void 0;function zl(e){return rt(e)||Cs(e)||!!(an&&e&&e[an])}function Gl(e,t,r,n,s){var o=-1,i=e.length;for(r||(r=zl),s||(s=[]);++o<i;){var a=e[o];r(a)&&Fs(s,a)}return s}var Us=Ps(Object.getPrototypeOf,Object),ql="[object Object]",Ql=Function.prototype,Yl=Object.prototype,ks=Ql.toString,Kl=Yl.hasOwnProperty,Vl=ks.call(Object);function Jl(e){if(!ne(e)||fe(e)!=ql)return!1;var t=Us(e);if(t===null)return!0;var r=Kl.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&ks.call(r)==Vl}var Xl="[object DOMException]",Zl="[object Error]";function Ws(e){if(!ne(e))return!1;var t=fe(e);return t==Zl||t==Xl||typeof e.message=="string"&&typeof e.name=="string"&&!Jl(e)}var eh=ur(function(e,t){try{return Os(e,void 0,t)}catch(r){return Ws(r)?r:new Error(r)}});function th(e){return function(t){return e==null?void 0:e[t]}}function rh(){this.__data__=new se,this.size=0}function nh(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function sh(e){return this.__data__.get(e)}function ih(e){return this.__data__.has(e)}var oh=200;function ah(e,t){var r=this.__data__;if(r instanceof se){var n=r.__data__;if(!Ve||n.length<oh-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Te(n)}return r.set(e,t),this.size=r.size,this}function Fe(e){var t=this.__data__=new se(e);this.size=t.size}Fe.prototype.clear=rh;Fe.prototype.delete=nh;Fe.prototype.get=sh;Fe.prototype.has=ih;Fe.prototype.set=ah;var Bs=typeof exports=="object"&&exports&&!exports.nodeType&&exports,cn=Bs&&typeof module=="object"&&module&&!module.nodeType&&module,ch=cn&&cn.exports===Bs,un=ch?X.Buffer:void 0;un&&un.allocUnsafe;function uh(e,t){return e.slice()}function fh(e,t){for(var r=-1,n=e==null?0:e.length,s=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[s++]=i)}return o}function lh(){return[]}var hh=Object.prototype,dh=hh.propertyIsEnumerable,fn=Object.getOwnPropertySymbols,ph=fn?function(e){return e==null?[]:(e=Object(e),fh(fn(e),function(t){return dh.call(e,t)}))}:lh;function gh(e,t,r){var n=t(e);return rt(e)?n:Fs(n,r(e))}function mh(e){return gh(e,Ns,ph)}var Gt=we(X,"DataView"),qt=we(X,"Promise"),Ie=we(X,"Set"),ln="[object Map]",yh="[object Object]",hn="[object Promise]",dn="[object Set]",pn="[object WeakMap]",gn="[object DataView]",bh=_e(Gt),vh=_e(Ve),$h=_e(qt),_h=_e(Ie),wh=_e(zt),Z=fe;(Gt&&Z(new Gt(new ArrayBuffer(1)))!=gn||Ve&&Z(new Ve)!=ln||qt&&Z(qt.resolve())!=hn||Ie&&Z(new Ie)!=dn||zt&&Z(new zt)!=pn)&&(Z=function(e){var t=fe(e),r=t==yh?e.constructor:void 0,n=r?_e(r):"";if(n)switch(n){case bh:return gn;case vh:return ln;case $h:return hn;case _h:return dn;case wh:return pn}return t});var Th=Object.prototype,Oh=Th.hasOwnProperty;function Sh(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&Oh.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var mn=X.Uint8Array;function hr(e){var t=new e.constructor(e.byteLength);return new mn(t).set(new mn(e)),t}function jh(e,t){var r=hr(e.buffer);return new e.constructor(r,e.byteOffset,e.byteLength)}var Eh=/\w*$/;function Ah(e){var t=new e.constructor(e.source,Eh.exec(e));return t.lastIndex=e.lastIndex,t}var yn=V?V.prototype:void 0,bn=yn?yn.valueOf:void 0;function Ih(e){return bn?Object(bn.call(e)):{}}function Ch(e,t){var r=hr(e.buffer);return new e.constructor(r,e.byteOffset,e.length)}var Dh="[object Boolean]",Mh="[object Date]",xh="[object Map]",Lh="[object Number]",Ph="[object RegExp]",Nh="[object Set]",Rh="[object String]",Fh="[object Symbol]",Uh="[object ArrayBuffer]",kh="[object DataView]",Wh="[object Float32Array]",Bh="[object Float64Array]",Hh="[object Int8Array]",zh="[object Int16Array]",Gh="[object Int32Array]",qh="[object Uint8Array]",Qh="[object Uint8ClampedArray]",Yh="[object Uint16Array]",Kh="[object Uint32Array]";function Vh(e,t,r){var n=e.constructor;switch(t){case Uh:return hr(e);case Dh:case Mh:return new n(+e);case kh:return jh(e);case Wh:case Bh:case Hh:case zh:case Gh:case qh:case Qh:case Yh:case Kh:return Ch(e);case xh:return new n;case Lh:case Rh:return new n(e);case Ph:return Ah(e);case Nh:return new n;case Fh:return Ih(e)}}function Jh(e){return typeof e.constructor=="function"&&!fr(e)?nf(Us(e)):{}}var Xh="[object Map]";function Zh(e){return ne(e)&&Z(e)==Xh}var vn=Me&&Me.isMap,ed=vn?lr(vn):Zh,td="[object Set]";function rd(e){return ne(e)&&Z(e)==td}var $n=Me&&Me.isSet,nd=$n?lr($n):rd,Hs="[object Arguments]",sd="[object Array]",id="[object Boolean]",od="[object Date]",ad="[object Error]",zs="[object Function]",cd="[object GeneratorFunction]",ud="[object Map]",fd="[object Number]",Gs="[object Object]",ld="[object RegExp]",hd="[object Set]",dd="[object String]",pd="[object Symbol]",gd="[object WeakMap]",md="[object ArrayBuffer]",yd="[object DataView]",bd="[object Float32Array]",vd="[object Float64Array]",$d="[object Int8Array]",_d="[object Int16Array]",wd="[object Int32Array]",Td="[object Uint8Array]",Od="[object Uint8ClampedArray]",Sd="[object Uint16Array]",jd="[object Uint32Array]",D={};D[Hs]=D[sd]=D[md]=D[yd]=D[id]=D[od]=D[bd]=D[vd]=D[$d]=D[_d]=D[wd]=D[ud]=D[fd]=D[Gs]=D[ld]=D[hd]=D[dd]=D[pd]=D[Td]=D[Od]=D[Sd]=D[jd]=!0;D[ad]=D[zs]=D[gd]=!1;function pt(e,t,r,n,s,o){var i;if(i!==void 0)return i;if(!Re(e))return e;var a=rt(e);if(a)i=Sh(e);else{var c=Z(e),u=c==zs||c==cd;if(Ms(e))return uh(e);if(c==Gs||c==Hs||u&&!s)i=u?{}:Jh(e);else{if(!D[c])return s?e:{};i=Vh(e,c)}}o||(o=new Fe);var f=o.get(e);if(f)return f;o.set(e,i),nd(e)?e.forEach(function(d){i.add(pt(d,t,r,d,e,o))}):ed(e)&&e.forEach(function(d,b){i.set(b,pt(d,t,r,b,e,o))});var l=mh,h=a?void 0:l(e);return df(h||e,function(d,b){h&&(b=d,d=e[b]),Es(i,b,pt(d,t,r,b,e,o))}),i}var Ed=1,Ad=4;function qs(e){return pt(e,Ed|Ad)}var Id="__lodash_hash_undefined__";function Cd(e){return this.__data__.set(e,Id),this}function Dd(e){return this.__data__.has(e)}function vt(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Te;++t<r;)this.add(e[t])}vt.prototype.add=vt.prototype.push=Cd;vt.prototype.has=Dd;function Md(e,t){return e.has(t)}function Qs(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}function xd(e){return ne(e)&&It(e)}var Ld={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Pd=th(Ld),Ys=/[&<>"']/g,Nd=RegExp(Ys.source);function Rd(e){return e=Rs(e),e&&Nd.test(e)?e.replace(Ys,Pd):e}function Fd(e,t){return $s(t,function(r){return e[r]})}var Ks=Object.prototype,Ud=Ks.hasOwnProperty;function _n(e,t,r,n){return e===void 0||At(e,Ks[r])&&!Ud.call(n,r)?t:e}var kd={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};function Wd(e){return"\\"+kd[e]}var Vs=/<%=([\s\S]+?)%>/g,Bd=/<%-([\s\S]+?)%>/g,Hd=/<%([\s\S]+?)%>/g,wn={escape:Bd,evaluate:Hd,interpolate:Vs,variable:"",imports:{_:{escape:Rd}}},zd="Invalid `variable` option passed into `_.template`",Gd=/\b__p \+= '';/g,qd=/\b(__p \+=) '' \+/g,Qd=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Yd=/[()=,{}\[\]\/\s]/,Kd=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,at=/($^)/,Vd=/['\n\r\u2028\u2029\\]/g,Jd=Object.prototype,Tn=Jd.hasOwnProperty;function On(e,t,r){var n=wn.imports._.templateSettings||wn;e=Rs(e),t=on({},t,n,_n);var s=on({},t.imports,n.imports,_n),o=Ns(s),i=Fd(s,o),a,c,u=0,f=t.interpolate||at,l="__p += '",h=RegExp((t.escape||at).source+"|"+f.source+"|"+(f===Vs?Kd:at).source+"|"+(t.evaluate||at).source+"|$","g"),d=Tn.call(t,"sourceURL")?"//# sourceURL="+(t.sourceURL+"").replace(/\s/g," ")+"\n":"";e.replace(h,function(_,j,S,L,G,k){return S||(S=L),l+=e.slice(u,k).replace(Vd,Wd),j&&(a=!0,l+="' +\n__e("+j+") +\n'"),G&&(c=!0,l+="';\n"+G+";\n__p += '"),S&&(l+="' +\n((__t = ("+S+")) == null ? '' : __t) +\n'"),u=k+_.length,_}),l+="';\n";var b=Tn.call(t,"variable")&&t.variable;if(!b)l="with (obj) {\n"+l+"\n}\n";else if(Yd.test(b))throw new Error(zd);l=(c?l.replace(Gd,""):l).replace(qd,"$1").replace(Qd,"$1;"),l="function("+(b||"obj")+") {\n"+(b?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(c?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var g=eh(function(){return Function(o,d+"return "+l).apply(void 0,i)});if(g.source=l,Ws(g))throw g;return g}var Xd=1/0,Zd=Ie&&1/Qs(new Ie([,-0]))[1]==Xd?function(e){return new Ie(e)}:sf,ep=200;function tp(e,t,r){var n=-1,s=bf,o=e.length,i=!0,a=[],c=a;if(o>=ep){var u=Zd(e);if(u)return Qs(u);i=!1,s=Md,c=new vt}else c=a;e:for(;++n<o;){var f=e[n],l=f;if(f=f!==0?f:0,i&&l===l){for(var h=c.length;h--;)if(c[h]===l)continue e;a.push(f)}else s(c,l,r)||(c!==a&&c.push(l),a.push(f))}return a}var rp=ur(function(e){return tp(Gl(e,1,xd))});class Js{}class Xs extends Js{constructor(r){super();m(this,"data",{});m(this,"event",new Tt.EventEmitter);this.data=r}update(r,n){n?Ht(n,r,this.data):this.data=r;const s={updateData:r,path:n!=null?n:""};n&&this.event.emit(n,s),this.event.emit("",s)}on(r,n){this.event.on(r,n)}off(r,n){this.event.off(r,n)}getData(r){return r?ye(r,this.data):this.data}destroy(){}}var $t,Je,Xe,Y,pe,Ze;class Zs extends Un{constructor(r){var o,i,a,c,u;super();m(this,"isInit",!1);m(this,"app");m(this,"mockData");z(this,$t,"base");z(this,Je);z(this,Xe);z(this,Y);z(this,pe,[]);z(this,Ze,[]);q(this,Je,r.schema.id),q(this,Xe,r.schema),this.app=r.app,this.setFields(r.schema.fields),this.setMethods(r.schema.methods||[]);let n=r.initialData;const s=r.ObservedDataClass||Xs;if(this.app.platform==="editor")this.mockData=((i=(o=r.schema.mocks)==null?void 0:o.find(f=>f.useInEditor))==null?void 0:i.data)||this.getDefaultData(),n=this.mockData;else if(typeof r.useMock=="boolean"&&r.useMock)this.mockData=((c=(a=r.schema.mocks)==null?void 0:a.find(f=>f.enable))==null?void 0:c.data)||this.getDefaultData(),n=this.mockData;else if(!r.initialData)n=this.getDefaultData();else{q(this,Y,new s((u=r.initialData)!=null?u:{})),this.isInit=!0;return}q(this,Y,new s(n!=null?n:{}))}get id(){return F(this,Je)}get type(){return F(this,$t)}get schema(){return F(this,Xe)}get fields(){return F(this,pe)}get methods(){return F(this,Ze)}setFields(r){q(this,pe,r)}setMethods(r){q(this,Ze,r)}get data(){return F(this,Y).getData("")}setData(r,n){F(this,Y).update(r,n);const s={updateData:r,path:n};this.emit("change",s)}onDataChange(r,n){F(this,Y).on(r,n)}offDataChange(r,n){F(this,Y).off(r,n)}getDefaultData(){return ms(F(this,pe))}async init(){this.isInit=!0}destroy(){q(this,pe,[]),this.removeAllListeners(),F(this,Y).destroy()}}$t=new WeakMap,Je=new WeakMap,Xe=new WeakMap,Y=new WeakMap,pe=new WeakMap,Ze=new WeakMap;const Sn=e=>Object.entries(e).reduce((t,[r,n])=>{let s=n;return typeof n=="object"&&(s=JSON.stringify(n)),typeof n<"u"?"".concat(t).concat(t?"&":"").concat(globalThis.encodeURIComponent(r),"=").concat(globalThis.encodeURIComponent("".concat(s))):t},""),np=async e=>{var f;const{url:t,method:r="GET",headers:n={},params:s={},data:o={},...i}=e,a=Sn(s);let c=JSON.stringify(o);return(f=n["Content-Type"])!=null&&f.includes("application/x-www-form-urlencoded")&&(c=Sn(o)),(await globalThis.fetch(a?"".concat(t,"?").concat(a):t,{method:r,headers:n,body:r==="GET"?void 0:c,...i})).json()};var Ce,et,tt,_t;class sp extends Zs{constructor(r){const{options:n}=r.schema;super(r);m(this,"isLoading",!1);m(this,"error");m(this,"httpOptions");z(this,Ce);z(this,et,[]);z(this,tt,[]);z(this,_t,"http");this.httpOptions=n,typeof r.request=="function"?q(this,Ce,r.request):typeof globalThis.fetch=="function"&&q(this,Ce,np),this.methods.forEach(s=>{typeof s.content=="function"&&(s.timing==="beforeRequest"&&F(this,et).push(s.content),s.timing==="afterRequest"&&F(this,tt).push(s.content))})}get type(){return F(this,_t)}async init(){this.schema.autoFetch&&await this.request(this.httpOptions),super.init()}async request(r={}){var s,o;this.isLoading=!0;let n={...this.httpOptions,...r};try{for(const a of F(this,et))await a({options:n,params:{},dataSource:this,app:this.app});typeof this.schema.beforeRequest=="function"&&(n=this.schema.beforeRequest(n,{app:this.app,dataSource:this}));let i=this.mockData?this.mockData:await((s=F(this,Ce))==null?void 0:s.call(this,n));for(const a of F(this,tt))await a({res:i,options:n,params:{},dataSource:this,app:this.app});if(typeof this.schema.afterResponse=="function"&&(i=this.schema.afterResponse(i,{app:this.app,dataSource:this,options:n})),(o=this.schema.responseOptions)!=null&&o.dataPath){const a=ye(this.schema.responseOptions.dataPath,i);this.setData(a)}else this.setData(i);this.error=void 0}catch(i){this.error={msg:i.message},this.emit("error",i)}this.isLoading=!1}get(r){return this.request({...r,method:"GET"})}post(r){return this.request({...r,method:"POST"})}}Ce=new WeakMap,et=new WeakMap,tt=new WeakMap,_t=new WeakMap;const ip=(e,t)=>{let r=!0;for(const{op:n,value:s,range:o,field:i}of e){const[a,...c]=i,u=t[a];if(!u||!c.length)break;const f=ye(c.join("."),u);if(!gs(n,f,s,o)){r=!1;break}}return r},ei=(e,t)=>{if(!e.displayConds||!Array.isArray(e.displayConds)||!e.displayConds.length)return!0;for(const{cond:r}of e.displayConds)if(r&&ip(r,t))return!0;return!1},op=(e=[],t)=>{if(!e||!Array.isArray(e)||!e.length)return!0;for(const{cond:r}of e){if(!r)continue;let n=!0;for(const{op:s,value:o,range:i,field:a}of r){const c=ye(a.join("."),t);if(!gs(s,c,o,i)){n=!1;break}}if(n)return n}return!1},jn=(e,t)=>{var r;if(ls(e)||mu(e)){const n=(r=t.items)==null?void 0:r.findIndex(s=>s.id===e.id);t.items.splice(n,1,e)}else hs(e,t.items)},ap=(e,t,r=[])=>{const n={[t]:{}};return r.reduce((s,o,i)=>(s[o]=i===r.length-1?e:{},s[o]),n[t]),n},cp=(e,t)=>{const[r,...n]=e,s=r.indexOf(mt);if(s>-1){const o=r.substring(s+mt.length),i=t[o];return i?ye(n.join("."),i):e}return e},ti=(e,t)=>typeof e=="string"?On(e)(t):e!=null&&e.isBindDataSource&&e.dataSourceId?t[e.dataSourceId]:e!=null&&e.isBindDataSourceField&&e.dataSourceId&&typeof e.template=="string"?On(e.template)(t[e.dataSourceId]):Array.isArray(e)&&typeof e[0]=="string"?cp(e,t):e,up=(e,t,r,n=[],s=!1)=>{const o=new $u;o.addTarget(new Gr({id:r,type:"data-source",isTarget:(c,u)=>"".concat(c).startsWith(ds)?!1:bu(u,r)||vu(u,r)})),o.addTarget(new Gr({id:r,type:"cond",isTarget:(c,u)=>!(!Array.isArray(u)||u[0]!==r||!"".concat(c).startsWith("displayConds"))})),o.collect(t,{},!0);const{deps:i}=o.getTarget(r,"data-source"),{deps:a}=o.getTarget(r,"cond");return!Object.keys(i).length&&!Object.keys(a).length?t:t.map(c=>{var f,l;const u=ap(e,r,n);return(f=a[c.id])!=null&&f.keys.length&&!s&&(c.condResult=ei(c,u)),(l=i[c.id])!=null&&l.keys.length?ps(h=>ti(h,u),qs(c),{[r]:i},r):c})},Q=class Q extends Un{constructor({app:r,useMock:n,initialData:s}){var i,a;super();m(this,"app");m(this,"dataSourceMap",new Map);m(this,"data",{});m(this,"useMock",!1);this.app=r,this.useMock=n,s&&(this.data=s),(a=(i=r.dsl)==null?void 0:i.dataSources)==null||a.forEach(c=>{this.addDataSource(c)});const o=Array.from(this.dataSourceMap);typeof Promise.allSettled=="function"?Promise.allSettled(o.map(([,c])=>this.init(c))).then(c=>{const u={},f={};c.forEach((l,h)=>{const d=o[h][0];l.status==="fulfilled"?u[d]=this.data[d]:l.status==="rejected"&&(f[d]=l.reason)}),this.emit("init",u,f)}):Promise.all(o.map(([,c])=>this.init(c))).then(()=>{this.emit("init",this.data)}).catch(()=>{this.emit("init",this.data)})}static register(r,n){Q.dataSourceClassMap.set(r,n)}static registe(r,n){Q.register(r,n)}static getDataSourceClass(r){return Q.dataSourceClassMap.get(r)}static registerObservedData(r){Q.ObservedDataClass=r}async init(r){var o;if(r.isInit||this.app.jsEngine&&((o=r.schema.disabledInitInJsEngine)!=null&&o.includes(this.app.jsEngine)))return;const n=[],s=[];r.methods.forEach(i=>{typeof i.content=="function"&&(i.timing==="beforeInit"&&n.push(i.content),i.timing==="afterInit"&&s.push(i.content))});for(const i of n)await i({params:{},dataSource:r,app:this.app});await r.init();for(const i of s)await i({params:{},dataSource:r,app:this.app})}get(r){return this.dataSourceMap.get(r)}async addDataSource(r){if(!r)return;const n=Q.dataSourceClassMap.get(r.type)||Zs,s=new n({app:this.app,schema:r,request:this.app.request,useMock:this.useMock,initialData:this.data[r.id],ObservedDataClass:Q.ObservedDataClass});this.dataSourceMap.set(r.id,s),this.data[s.id]=s.data,s.on("change",o=>{this.setData(s,o)})}setData(r,n){this.data[r.id]=r.data,this.emit("change",r.id,n)}removeDataSource(r){var n;(n=this.get(r))==null||n.destroy(),delete this.data[r],this.dataSourceMap.delete(r)}updateSchema(r){r.forEach(n=>{if(!this.get(n.id))return;this.removeDataSource(n.id),this.addDataSource(n);const o=this.get(n.id);o&&this.init(o)})}compiledNode({items:r,...n},s,o=!1){var a;const i=qs(n);return r&&(i.items=Array.isArray(r)&&o?r.map(c=>this.compiledNode(c,s,o)):r),n.condResult===!1||n.visible===!1?i:ps(c=>ti(c,this.data),i,((a=this.app.dsl)==null?void 0:a.dataSourceDeps)||{},s)}compliedConds(r){return ei(r,this.data)}compliedIteratorItemConds(r,n=[]){return op(n,r)}compliedIteratorItems(r,n,s=[]){const[o,...i]=s;return this.get(o)?up(r,n,o,i,this.app.platform==="editor"):n}destroy(){this.removeAllListeners(),this.data={},this.dataSourceMap.forEach(r=>{r.destroy()}),this.dataSourceMap.clear()}onDataChange(r,n,s){var o;return(o=this.get(r))==null?void 0:o.onDataChange(n,s)}offDataChange(r,n,s){var o;return(o=this.get(r))==null?void 0:o.offDataChange(n,s)}};m(Q,"dataSourceClassMap",new Map),m(Q,"ObservedDataClass",Xs);let xe=Q;xe.register("http",sp);const fp=(e,t,r)=>{const{dsl:n,platform:s}=e;if(!(n!=null&&n.dataSources))return;const o=new xe({app:e,useMock:t,initialData:r});return n.dataSources&&n.dataSourceCondDeps&&s!=="editor"&&Pt(Hr(n.dataSourceCondDeps),n.items).forEach(i=>{i.condResult=o.compliedConds(i),jn(i,n)}),n.dataSources&&n.dataSourceDeps&&Pt(Hr(n.dataSourceDeps),n.items).forEach(i=>{jn(o.compiledNode(i),n)}),e.jsEngine!=="nodejs"&&o.on("change",(i,a)=>{var h,d,b;const c=((h=n.dataSourceDeps)==null?void 0:h[i])||{},u=((d=n.dataSourceCondDeps)==null?void 0:d[i])||{},f=rp([...Object.keys(u),...Object.keys(c)]),l=(b=e.page)!=null&&b.data&&e.platform!=="editor"?[e.page.data]:n.items;o.emit("update-data",Pt(f,l).map(g=>{var j;e.platform!=="editor"&&(g.condResult=o.compliedConds(g));const _=o.compiledNode(g);if(typeof((j=e.page)==null?void 0:j.setData)=="function")if(ls(_))e.page.setData(_);else{const S=e.page.getNode(g.id);S==null||S.setData(_)}return _}),i,a)}),o},lp=e=>{let t=0;return(...r)=>{if(t===0){t+=1;return}return e(...r)}};class hp extends Js{constructor(r){super();m(this,"state");m(this,"subscribers",new Map);m(this,"update",(r,n)=>{var s;(s=this.state)==null||s.update(n!=null?n:"",r)});m(this,"on",(r,n)=>{var i;const s=this.state.subscribe(r,lp(n)),o=(i=this.subscribers.get(r))!=null?i:new Map;o.set(n,s),this.subscribers.set(r,o)});m(this,"off",(r,n)=>{var o;const s=this.subscribers.get(r);s&&((o=s.get(n))==null||o(),s.delete(n))});m(this,"getData",r=>{var n;return this.state?(n=this.state)==null?void 0:n.get(r):{}});m(this,"destroy",()=>{this.subscribers.forEach(r=>{r.forEach(n=>n())})});this.state=new Au(r)}}class En{constructor(t=globalThis.navigator.userAgent,r={}){m(this,"isIos",!1);m(this,"isIphone",!1);m(this,"isIpad",!1);m(this,"isAndroid",!1);m(this,"isAndroidPad",!1);m(this,"isMac",!1);m(this,"isWin",!1);m(this,"isMqq",!1);m(this,"isWechat",!1);m(this,"isWeb",!1);this.isIphone=t.indexOf("iPhone")>=0,this.isIpad=/(iPad).*OS\s([\d_]+)/.test(t),this.isIos=this.isIphone||this.isIpad,this.isAndroid=t.indexOf("Android")>=0,this.isAndroidPad=this.isAndroid&&t.indexOf("Mobile")<0,this.isMac=t.indexOf("Macintosh")>=0,this.isWin=t.indexOf("Windows")>=0,this.isMqq=/QQ\/([\d.]+)/.test(t),this.isWechat=t.indexOf("MicroMessenger")>=0&&t.indexOf("wxwork")<0,this.isWeb=!this.isIos&&!this.isAndroid&&!/(WebOS|BlackBerry)/.test(t),Object.entries(r).forEach(([n,s])=>{this[n]=s})}}const An="magic:common:events:",ri="magic:common:actions:",ct={SHOW:"show",HIDE:"hide",SCROLL_TO_VIEW:"scrollIntoView",SCROLL_TO_TOP:"scrollToTop"},dp=e=>e.startsWith(An)?e:"".concat(An).concat(e),pp=e=>e.startsWith(ri),ni=(e,t)=>{var n;if(!e)return!1;if(!e.id)return ni(e.parentElement,t);const r=(n=t.page)==null?void 0:n.getNode(e.id);return r||!1},In=(e,t,r)=>{const n=ni(r.target,e);n&&e.emit(dp(t),n)},gp=e=>{e.jsEngine==="browser"&&(window.document.body.addEventListener("click",t=>{In(e,"click",t)}),window.document.body.addEventListener("click",t=>{In(e,"click:capture",t)},!0))},mp=(e,t)=>{var n;const{instance:r}=t;if(r)switch(e.replace(ri,"")){case ct.SHOW:r.show();break;case ct.HIDE:r.hide();break;case ct.SCROLL_TO_VIEW:(n=r.$el)==null||n.scrollIntoView({behavior:"smooth"});break;case ct.SCROLL_TO_TOP:window.scrollTo({top:0,behavior:"smooth"});break}};class yp{constructor(){m(this,"data",{})}set(t,r){this.data[t]=r}get(t){return this.data[t]}}class Qt extends Tt.EventEmitter{constructor(r){super();m(this,"data");m(this,"style");m(this,"events",[]);m(this,"instance");m(this,"page");m(this,"parent");m(this,"app");m(this,"store",new yp);this.page=r.page,this.parent=r.parent,this.app=r.app,this.setData(r.config),this.listenLifeSafe()}setData(r){this.data=r;const{events:n,style:s}=r;this.events=n||[],this.style=s||{},this.emit("update-data")}destroy(){this.removeAllListeners()}listenLifeSafe(){this.once("created",async r=>{this.once("destroy",()=>{this.instance=null,typeof this.data.destroy=="function"&&this.data.destroy(this),this.listenLifeSafe()}),this.instance=r,await this.runHookCode("created")}),this.once("mounted",async r=>{this.instance=r;const n=this.app.eventQueueMap[r.config.id]||[];for(let s=n.shift();s;s=n.shift())this.app.compActionHandler(s.eventConfig,s.fromCpt,s.args);await this.runHookCode("mounted")})}async runHookCode(r){var s,o,i;if(typeof this.data[r]=="function"){await this.data[r](this);return}const n=this.data[r];if((n==null?void 0:n.hookType)===fs.CODE)for(const a of n.hookData){const{codeType:c=ht.CODE,codeId:u,params:f={}}=a;let l;const h={app:this.app,params:f};if(c===ht.CODE&&typeof u=="string"&&((s=this.app.codeDsl)!=null&&s[u]))l=this.app.codeDsl[u].content;else if(c===ht.DATA_SOURCE_METHOD&&Array.isArray(u)&&u.length>1){const d=(o=this.app.dataSourceManager)==null?void 0:o.get(u[0]);l=(i=d==null?void 0:d.methods.find(b=>b.name===u[1]))==null?void 0:i.content,h.dataSource=d}l&&typeof l=="function"&&await l(h)}}}class bp extends Qt{constructor(r){super(r);m(this,"nodes",new Map);this.setNode(r.config.id,this),r.config.items.forEach(n=>{this.initNode(n,this)})}initNode(r,n){var o,i,a;const s=new Qt({config:r,parent:n,page:this,app:this.app});if(this.setNode(r.id,s),r.type==="page-fragment-container"&&r.pageFragmentId){const c=(i=(o=this.app.dsl)==null?void 0:o.items)==null?void 0:i.find(u=>u.id===r.pageFragmentId);c&&(r.items=[c])}(a=r.items)==null||a.forEach(c=>{this.initNode(c,s)})}getNode(r){return this.nodes.get(r)}setNode(r,n){this.nodes.set(r,n)}deleteNode(r){this.nodes.delete(r)}destroy(){super.destroy(),this.nodes.clear()}}const vp=e=>{if(typeof e!="string")return e;const t={};return e.split(";").forEach(r=>{if(!r)return;const n=r.split(":");let s=n.shift(),o=n.join(":");s&&(s=s.replace(/^\s*/,"").replace(/\s*$/,""),o=o.replace(/^\s*/,"").replace(/\s*$/,""),s=s.split("-").map((i,a)=>a>0?"".concat(i[0].toUpperCase()).concat(i.substr(1)):i).join(""),t[s]=o)}),t},$p=e=>e&&!/^url/.test(e)&&!/^linear-gradient/.test(e)?"url(".concat(e,")"):e,_p=e=>/^(-?\d+)(\.\d+)?$/.test(e),wp=(e,t)=>{if(!e)return[];const r=Object.entries(e).map(([s,o])=>o.trim()?(s==="rotate"&&_p(o)&&(o="".concat(o,"deg")),t!=="hippy"?"".concat(s,"(").concat(o,")"):{[s]:o}):"");if(t==="hippy")return r;const n=r.join(" ");return n.trim()?n:"none"},Tp=(e,t)=>{if(!e)return{};let r={};const n={};typeof e=="string"?r=vp(e):r={...e};const s=t==="hippy",o=["zIndex","opacity","fontWeight"];return Object.entries(r).forEach(([i,a])=>{i==="scale"&&!n.transform&&s?n.transform=[{scale:a}]:i==="backgroundImage"&&!s?a&&(n[i]=$p(a)):i==="transform"&&typeof a!="string"?n[i]=wp(a,t):!o.includes(i)&&a&&/^[-]?[0-9]*[.]?[0-9]*$/.test(a)?n[i]=s?a:"".concat(a/100,"rem"):n[i]=a}),n},Op=e=>{const{width:t}=document.documentElement.getBoundingClientRect(),r=t/(e/100);document.documentElement.style.fontSize="".concat(r,"px")};class Sp extends Tt.EventEmitter{constructor(r){var n;super();m(this,"env",new En);m(this,"dsl");m(this,"codeDsl");m(this,"dataSourceManager");m(this,"page");m(this,"useMock",!1);m(this,"platform","mobile");m(this,"jsEngine","browser");m(this,"designWidth",375);m(this,"request");m(this,"components",new Map);m(this,"eventQueueMap",{});m(this,"transformStyle");m(this,"eventList",new Map);m(this,"dataSourceEventList",new Map);this.setEnv(r.ua),this.codeDsl=(n=r.config)==null?void 0:n.codeBlocks,r.platform&&(this.platform=r.platform),r.jsEngine&&(this.jsEngine=r.jsEngine),typeof r.useMock=="boolean"&&(this.useMock=r.useMock),typeof r.designWidth<"u"&&this.setDesignWidth(r.designWidth),this.transformStyle=r.transformStyle||(s=>Tp(s,this.jsEngine)),r.request&&(this.request=r.request),r.config&&this.setConfig(r.config,r.curPage),gp(this)}setEnv(r){this.env=new En(r)}setDesignWidth(r){this.designWidth=r,this.jsEngine==="browser"&&(this.calcFontsize(),globalThis.removeEventListener("resize",this.calcFontsize),globalThis.addEventListener("resize",this.calcFontsize))}setConfig(r,n){var s,o;this.dsl=r,!n&&r.items.length&&(n=r.items[0].id),this.dataSourceManager&&this.dataSourceManager.destroy(),this.dataSourceManager=fp(this,this.useMock),this.codeDsl=r.codeBlocks,this.setPage(n||((o=(s=this.page)==null?void 0:s.data)==null?void 0:o.id))}addPage(){console.info("addPage 已经弃用")}setPage(r){var s,o;const n=(s=this.dsl)==null?void 0:s.items.find(i=>"".concat(i.id)==="".concat(r));if(!n){this.page&&(this.page.destroy(),this.page=void 0),super.emit("page-change");return}n!==((o=this.page)==null?void 0:o.data)&&(this.page&&this.page.destroy(),this.page=new bp({config:n,app:this}),super.emit("page-change",this.page),this.bindEvents())}deletePage(){this.page=void 0}getPage(r){if(!r)return this.page;if(this.page&&"".concat(this.page.data.id)==="".concat(r))return this.page}registerComponent(r,n){this.components.set(r,n)}unregisterComponent(r){this.components.delete(r)}resolveComponent(r){return this.components.get(r)}bindEvents(){var r;if(Array.from(this.eventList.keys()).forEach(n=>{const s=this.eventList.get(n);s&&this.off(s,n)}),this.eventList.clear(),!!this.page){for(const[,n]of this.page.nodes)(r=n.events)==null||r.forEach((s,o)=>{let i="".concat(s.name,"_").concat(n.data.id),a=(u,...f)=>{this.eventHandler(o,u,f)};const c=s.name.split(".");c.length>1&&(i="".concat(c[1],"_").concat(c[0]),a=(u,...f)=>{this.eventHandler(o,n,f)}),this.eventList.set(a,i),this.on(i,a)});this.bindDataSourceEvents()}}emit(r,...n){var i;const[s,...o]=n;return s instanceof Qt&&((i=s==null?void 0:s.data)!=null&&i.id)?super.emit("".concat(String(r),"_").concat(s.data.id),s,...o):super.emit(r,...n)}async codeActionHandler(r,n){var a,c;const{codeId:s="",params:o={}}=r;if(!s||lu(this.codeDsl))return;const i=(c=(a=this.codeDsl)==null?void 0:a[s])==null?void 0:c.content;typeof i=="function"&&await i({app:this,params:o,eventParams:n})}async compActionHandler(r,n,s){if(!this.page)throw new Error("当前没有页面");let{method:o,to:i}=r;te(o)&&([i,o]=o);const a=this.page.getNode(i);if(!a)throw"ID为".concat(i,"的组件不存在");if(pp(o))return mp(o,a);a.instance?typeof a.instance[o]=="function"&&await a.instance[o](n,...s):this.addEventToMap({eventConfig:r,fromCpt:n,args:s})}async dataSourceActionHandler(r,n){var l;const{dataSourceMethod:s=[],params:o={}}=r,[i,a]=s;if(!i||!a)return;const c=(l=this.dataSourceManager)==null?void 0:l.get(i);if(!c)return;const f=(c.methods||[]).find(h=>h.name===a);f&&typeof f.content=="function"&&await f.content({app:this,params:o,dataSource:c,eventParams:n})}destroy(){this.removeAllListeners(),this.page=void 0,this.jsEngine==="browser"&&globalThis.removeEventListener("resize",this.calcFontsize)}bindDataSourceEvents(){var r;this.platform!=="editor"&&(Array.from(this.dataSourceEventList.keys()).forEach(n=>{const s=this.dataSourceEventList.get(n);Array.from(s.keys()).forEach(o=>{var c,u,f;const[i,...a]=o.split(".");i===zr?(c=this.dataSourceManager)==null||c.offDataChange(n,a.join("."),s.get(o)):(f=(u=this.dataSourceManager)==null?void 0:u.get(n))==null||f.off(i,s.get(o))})}),(((r=this.dsl)==null?void 0:r.dataSources)||[]).forEach(n=>{var o;const s=(o=this.dataSourceEventList.get(n.id))!=null?o:new Map;(n.events||[]).forEach(i=>{var f,l,h,d;const[a,...c]=((f=i.name)==null?void 0:f.split("."))||[];if(!a)return;const u=(...b)=>{var g;this.eventHandler(i,(g=this.dataSourceManager)==null?void 0:g.get(n.id),b)};s.set(i.name,u),a===zr?(l=this.dataSourceManager)==null||l.onDataChange(n.id,c.join("."),u):(d=(h=this.dataSourceManager)==null?void 0:h.get(n.id))==null||d.on(a,u)}),this.dataSourceEventList.set(n.id,s)}))}async actionHandler(r,n,s){r.actionType===lt.COMP?await this.compActionHandler(r,n,s):r.actionType===lt.CODE?await this.codeActionHandler(r,s):r.actionType===lt.DATA_SOURCE&&await this.dataSourceActionHandler(r,s)}async eventHandler(r,n,s){const o=typeof r=="number"?n.events[r]:r;if(ou(o,"actions")){const{actions:i}=o;for(let a=0;a<i.length;a++)if(typeof r=="number"){const c=n.events[r].actions[a];this.actionHandler(c,n,s)}else this.actionHandler(i[a],n,s)}else await this.compActionHandler(o,n,s)}addEventToMap(r){this.eventQueueMap[r.eventConfig.to]?this.eventQueueMap[r.eventConfig.to].push(r):this.eventQueueMap[r.eventConfig.to]=[r]}calcFontsize(){Op(this.designWidth)}}const jp=(e,t=window)=>{var i;const r=VueDemi.ref(),n=VueDemi.ref(),s=VueDemi.ref(),o=VueDemi.computed(()=>{var a,c,u,f;return((c=(a=r.value)==null?void 0:a.items)==null?void 0:c.find(l=>l.id===n.value))||((f=(u=r.value)==null?void 0:u.items)==null?void 0:f[0])});return VueDemi.watch(o,async()=>{var c;await VueDemi.nextTick();const a=document.querySelector(".magic-ui-page");a&&((c=t.magic)==null||c.onPageElUpdate(a))}),(i=t.magic)==null||i.onRuntimeReady({getApp(){return e},updateRootConfig(a){r.value=a,e==null||e.setConfig(a,n.value)},updatePageId(a){n.value=a,e==null||e.setPage(a)},select(a){var u;s.value=a,e!=null&&e.getPage(a)&&((u=this.updatePageId)==null||u.call(this,a));const c=document.getElementById("".concat(a));return c||VueDemi.nextTick().then(()=>document.getElementById("".concat(a)))},add({config:a,parentId:c}){var f,l,h,d,b;if(!r.value)throw new Error("error");if(!s.value)throw new Error("error");if(!c)throw new Error("error");const u=Ge(c,[r.value]).pop();if(!u)throw new Error("未找到父节点");if(a.type!=="page"){const g=(f=e==null?void 0:e.page)==null?void 0:f.getNode(u.id);g&&((l=e==null?void 0:e.page)==null||l.initNode(a,g))}if(u.id!==s.value){const g=(h=u.items)==null?void 0:h.findIndex(_=>_.id===s.value);(d=u.items)==null||d.splice(g+1,0,a)}else(b=u.items)==null||b.push(a)},update({config:a,parentId:c}){var l,h,d;if(!r.value||!e)throw new Error("error");const u=((l=e.dataSourceManager)==null?void 0:l.compiledNode(a,void 0,!0))||a;hs(VueDemi.reactive(u),[r.value],c);const f=(h=e.page)==null?void 0:h.getNode(a.id);f&&f.setData(u),((d=e.page)==null?void 0:d.data.id)===a.id&&e.page.setData(u)},remove({id:a,parentId:c}){var h,d;if(!r.value)throw new Error("error");const u=Ge(a,[r.value]).pop();if(!u)throw new Error("未找到目标元素");const f=Ge(c,[r.value]).pop();if(!f)throw new Error("未找到父元素");u.type==="page"?e==null||e.deletePage():(h=e==null?void 0:e.page)==null||h.deleteNode(u.id);const l=(d=f.items)==null?void 0:d.findIndex(b=>b.id===u.id);f.items.splice(l,1)}}),{pageConfig:o}},Ep=Vue.defineComponent({__name:"App",setup(e){const t=Vue.inject("app"),{pageConfig:r}=jp(t);return(n,s)=>{const o=Vue.resolveComponent("magic-ui-page");return Vue.unref(r)?(Vue.openBlock(),Vue.createBlock(o,{key:Vue.unref(r).id,config:Vue.unref(r)},null,8,["config"])):Vue.createCommentVNode("",!0)}}});xe.registerObservedData(hp);Promise.all([Mt(()=>import("./comp-entry-BLA7j4kV.js"),__vite__mapDeps([0,1])),Mt(()=>import("./plugin-entry-B1O5LaIO.js"),[]),Mt(()=>import("./datasource-entry-yoD6TSFD.js"),[])]).then(([e,t,r])=>{const n=Vue.createApp(Ep),s=new Sp({ua:window.navigator.userAgent,platform:"editor"});s.env.isWeb&&s.setDesignWidth(window.document.documentElement.getBoundingClientRect().width),Object.entries(e.default).forEach(([o,i])=>{n.component("magic-ui-".concat(o),i)}),Object.entries(r.default).forEach(([o,i])=>{xe.register(o,i)}),Object.values(t.default).forEach(o=>{n.use(o,{app:s})}),window.appInstance=s,n.config.globalProperties.app=s,n.provide("app",s),n.mount("#app")});export{Ip as __vite_legacy_guard};
//# sourceMappingURL=index-Bhq8EGjF.js.map
